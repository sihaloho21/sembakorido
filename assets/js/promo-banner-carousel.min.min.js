class PromotionalBannerCarousel{constructor(){this.banners=[],this.currentIndex=0,this.autoRotateInterval=null,this.isTransitioning=!1,this.autoRotateDelay=5e3,this.init()}async init(){await this.fetchBanners(),this.banners.length>0?(this.render(),this.setupEventListeners(),this.startAutoRotate()):this.hideContainer()}async fetchBanners(){try{const t=CONFIG.getMainApiUrl();console.log("ðŸ”„ [PROMO-BANNER] Fetching banners from:",t);const e=await fetch(`${t}?sheet=banners`);if(!e.ok)throw new Error(`HTTP ${e.status}: ${e.statusText}`);const n=await e.json();console.log("ðŸ“¥ [PROMO-BANNER] Received banners:",n);const o=new Date;this.banners=n.filter(t=>{if("active"!==t.status)return!1;if(t.start_date){const e=new Date(t.start_date);if(o<e)return!1}if(t.end_date){const e=new Date(t.end_date);if(o>e)return!1}return!0}),console.log(`âœ… [PROMO-BANNER] Loaded ${this.banners.length} active banners`)}catch(t){console.error("âŒ [PROMO-BANNER] Error fetching banners:",t),this.banners=[]}}hideContainer(){const t=document.getElementById("promo-banner-carousel-container");t&&(t.style.display="none")}render(){const t=document.getElementById("promo-banner-carousel-container");if(!t)return void console.warn("âš ï¸ [PROMO-BANNER] Container not found");t.style.display="block";const e=this.banners.length>1;t.innerHTML=`\n            <div class="promo-banner-wrapper">\n                ${e?'\n                <button class="promo-carousel-nav promo-carousel-prev" id="promo-carousel-prev" aria-label="Previous">\n                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>\n                    </svg>\n                </button>\n                ':""}\n                \n                <div class="promo-carousel-track-container">\n                    <div class="promo-carousel-track" id="promo-carousel-track">\n                        ${this.banners.map((t,e)=>this.renderBannerSlide(t,e)).join("")}\n                    </div>\n                </div>\n                \n                ${e?'\n                <button class="promo-carousel-nav promo-carousel-next" id="promo-carousel-next" aria-label="Next">\n                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>\n                    </svg>\n                </button>\n                ':""}\n            </div>\n            \n            ${e?`\n            <div class="promo-carousel-dots" id="promo-carousel-dots">\n                ${this.banners.map((t,e)=>`\n                    <button class="promo-carousel-dot ${0===e?"active":""}" data-index="${e}" aria-label="Go to slide ${e+1}"></button>\n                `).join("")}\n            </div>\n            `:""}\n        `,this.updateCarousel()}renderBannerSlide(t,e){const n=t.cta_url&&""!==t.cta_url.trim(),o=t.title&&""!==t.title.trim()||t.subtitle&&""!==t.subtitle.trim()||t.cta_text&&""!==t.cta_text.trim();return n&&t.cta_url.startsWith("#produk-")&&console.log(`[Banner] Creating deep link for: ${t.title||"Untitled"} -> ${t.cta_url}`),`\n            <div class="promo-carousel-slide" data-index="${e}">\n                <div class="promo-banner-card">\n                    ${n?`<a href="${t.cta_url}" class="promo-banner-link">`:""}\n                        <div class="promo-banner-image-container lazy-image-wrapper">\n                            <div class="skeleton skeleton-banner"></div>\n                            <img src="${t.image_url}" alt="${t.title||"Banner Promosi"}" class="promo-banner-image" loading="${0===e?"eager":"lazy"}" onerror="this.src='https://placehold.co/1200x400?text=Banner+Promosi'" onload="this.classList.add('loaded'); this.previousElementSibling.style.display='none';">\n                        </div>\n                        ${o?`\n                        <div class="promo-banner-caption">\n                            ${t.title?`<h3 class="promo-banner-title">${t.title}</h3>`:""}\n                            ${t.subtitle?`<p class="promo-banner-subtitle">${t.subtitle}</p>`:""}\n                            ${t.cta_text&&n?`<button class="promo-cta-button">${t.cta_text}</button>`:""}\n                        </div>\n                        `:""}\n                    ${n?"</a>":""}\n                </div>\n            </div>\n        `}setupEventListeners(){const t=document.getElementById("promo-carousel-prev"),e=document.getElementById("promo-carousel-next"),n=document.querySelectorAll(".promo-carousel-dot");t&&t.addEventListener("click",()=>{this.prev(),this.stopAutoRotate(),this.startAutoRotate()}),e&&e.addEventListener("click",()=>{this.next(),this.stopAutoRotate(),this.startAutoRotate()}),n.forEach(t=>{t.addEventListener("click",t=>{const e=parseInt(t.target.dataset.index);this.goToSlide(e),this.stopAutoRotate(),this.startAutoRotate()})});const o=document.getElementById("promo-carousel-track");if(o){let t=0,e=0,n=!1;o.addEventListener("touchstart",e=>{t=e.touches[0].clientX,n=!0,this.stopAutoRotate()}),o.addEventListener("touchmove",t=>{n&&(e=t.touches[0].clientX)}),o.addEventListener("touchend",()=>{if(!n)return;n=!1;const o=t-e;Math.abs(o)>50&&(o>0?this.next():this.prev()),this.startAutoRotate()})}const s=document.getElementById("promo-banner-carousel-container");s&&window.innerWidth>=768&&(s.addEventListener("mouseenter",()=>{this.stopAutoRotate()}),s.addEventListener("mouseleave",()=>{this.startAutoRotate()}))}updateCarousel(){const t=document.getElementById("promo-carousel-track"),e=document.querySelectorAll(".promo-carousel-dot"),n=document.getElementById("promo-carousel-prev"),o=document.getElementById("promo-carousel-next");if(!t)return;const s=-100*this.currentIndex;t.style.transform=`translateX(${s}%)`,e.forEach((t,e)=>{t.classList.toggle("active",e===this.currentIndex)}),n&&o&&(n.style.opacity=0===this.currentIndex?"0.5":"1",o.style.opacity=this.currentIndex>=this.banners.length-1?"0.5":"1")}next(){this.isTransitioning||(this.currentIndex>=this.banners.length-1?this.currentIndex=0:this.currentIndex++,this.isTransitioning=!0,this.updateCarousel(),setTimeout(()=>{this.isTransitioning=!1},500))}prev(){this.isTransitioning||(this.currentIndex<=0?this.currentIndex=this.banners.length-1:this.currentIndex--,this.isTransitioning=!0,this.updateCarousel(),setTimeout(()=>{this.isTransitioning=!1},500))}goToSlide(t){this.isTransitioning||t===this.currentIndex||(this.currentIndex=t,this.isTransitioning=!0,this.updateCarousel(),setTimeout(()=>{this.isTransitioning=!1},500))}startAutoRotate(){this.banners.length<=1||(this.stopAutoRotate(),this.autoRotateInterval=setInterval(()=>{this.next()},this.autoRotateDelay))}stopAutoRotate(){this.autoRotateInterval&&(clearInterval(this.autoRotateInterval),this.autoRotateInterval=null)}async refresh(){this.stopAutoRotate(),await this.fetchBanners(),this.currentIndex=0,this.banners.length>0?(this.render(),this.setupEventListeners(),this.startAutoRotate()):this.hideContainer()}}let promoBannerCarousel,promoResizeTimeout;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{promoBannerCarousel=new PromotionalBannerCarousel}):promoBannerCarousel=new PromotionalBannerCarousel,window.addEventListener("resize",()=>{clearTimeout(promoResizeTimeout),promoResizeTimeout=setTimeout(()=>{promoBannerCarousel&&promoBannerCarousel.updateCarousel()},250)});