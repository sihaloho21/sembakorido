function getPaylaterConfigSafe(){return"undefined"!=typeof CONFIG&&"function"==typeof CONFIG.getPaylaterConfig?CONFIG.getPaylaterConfig():{enabled:!1,profitToLimitPercent:10,tenorFees:{1:5,2:10,3:15,4:20},dailyPenaltyPercent:.5,penaltyCapPercent:15,maxActiveInvoices:1,maxLimit:1e6,minOrderAmount:0,freezeOverdueDays:7,lockOverdueDays:30}}function toMoneyInt(e){const t=Number(e);return Number.isFinite(t)?Math.max(0,Math.round(t)):0}function normalizeTenorWeeks(e){const t=parseInt(e,10);return Number.isFinite(t)?Math.min(4,Math.max(1,t)):1}function getTenorFeePercent(e,t){const n=t||getPaylaterConfigSafe(),a=normalizeTenorWeeks(e),o=n&&n.tenorFees?n.tenorFees[a]:0,i=Number(o);return Number.isFinite(i)?Math.max(0,i):0}function calculatePaylaterInvoice(e,t,n){const a=toMoneyInt(e),o=getTenorFeePercent(t,n),i=toMoneyInt(a*o/100),r=a+i;return{principal:a,tenorWeeks:normalizeTenorWeeks(t),feePercent:o,feeAmount:i,totalBeforePenalty:r}}function calculatePenaltyAmount(e,t,n){const a=n||getPaylaterConfigSafe(),o=toMoneyInt(e),i=Math.max(0,parseInt(t,10)||0),r=Number(a.dailyPenaltyPercent)||0,l=Number(a.penaltyCapPercent)||0,c=toMoneyInt(o*r*i/100),u=toMoneyInt(o*l/100);return Math.min(c,u)}function calculateTotalDueWithPenalty(e,t,n){const a=e||{},o=toMoneyInt(a.totalBeforePenalty||a.total_due||0),i=calculatePenaltyAmount(o,t,n);return{totalBeforePenalty:o,penaltyAmount:i,totalDue:o+i}}function calculateLimitIncreaseFromProfit(e,t){const n=t||getPaylaterConfigSafe(),a=toMoneyInt(e);return toMoneyInt(a*(Number(n.profitToLimitPercent)||0)/100)}function evaluatePaylaterEligibility(e,t){const n=t||getPaylaterConfigSafe(),a=e||{},o=a.account||{};if(!n.enabled)return{eligible:!1,reason:"paylater_disabled"};if(!o||!o.status)return{eligible:!1,reason:"account_not_found"};const i=String(o.status).toLowerCase();if("frozen"===i)return{eligible:!1,reason:"account_frozen"};if("locked"===i)return{eligible:!1,reason:"account_locked"};if("active"!==i)return{eligible:!1,reason:"account_inactive"};if((parseInt(a.activeInvoicesCount,10)||0)>=(parseInt(n.maxActiveInvoices,10)||1))return{eligible:!1,reason:"active_invoice_exists"};const r=toMoneyInt(a.orderTotal);if(r<toMoneyInt(n.minOrderAmount))return{eligible:!1,reason:"below_min_order"};const l=toMoneyInt(o.available_limit||o.availableLimit||0);return l<r?{eligible:!1,reason:"insufficient_limit"}:{eligible:!0,reason:"ok",availableLimit:l,orderTotal:r}}const PaylaterLogic={getPaylaterConfigSafe:getPaylaterConfigSafe,toMoneyInt:toMoneyInt,normalizeTenorWeeks:normalizeTenorWeeks,getTenorFeePercent:getTenorFeePercent,calculatePaylaterInvoice:calculatePaylaterInvoice,calculatePenaltyAmount:calculatePenaltyAmount,calculateTotalDueWithPenalty:calculateTotalDueWithPenalty,calculateLimitIncreaseFromProfit:calculateLimitIncreaseFromProfit,evaluatePaylaterEligibility:evaluatePaylaterEligibility};"undefined"!=typeof window&&(window.PaylaterLogic=PaylaterLogic);