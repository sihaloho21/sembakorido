const CONFIG={DEFAULTS:{MAIN_API:"https://script.google.com/macros/s/AKfycbwDmh_cc-J9c0cuzcSThFQBdiZ7lpy3oUjDENZhHW-4UszuKwPB20g6OeRccVsgvp79hw/exec",ADMIN_API:"https://script.google.com/macros/s/AKfycbwDmh_cc-J9c0cuzcSThFQBdiZ7lpy3oUjDENZhHW-4UszuKwPB20g6OeRccVsgvp79hw/exec",VERSION:"4.2.0"},STORAGE_KEYS:{MAIN_API:"sembako_main_api_url",ADMIN_API:"sembako_admin_api_url",GAJIAN_CONFIG:"sembako_gajian_config",REWARD_CONFIG:"sembako_reward_config",STORE_CLOSED:"sembako_store_closed"},getMainApiUrl(){return localStorage.getItem(this.STORAGE_KEYS.MAIN_API)||this.DEFAULTS.MAIN_API},getAdminApiUrl(){return localStorage.getItem(this.STORAGE_KEYS.ADMIN_API)||this.DEFAULTS.ADMIN_API},setMainApiUrl(t){return!(!t||!t.trim())&&(localStorage.setItem(this.STORAGE_KEYS.MAIN_API,t.trim()),typeof ApiService<"u"&&ApiService.clearCache(),!0)},setAdminApiUrl(t){return!(!t||!t.trim())&&(localStorage.setItem(this.STORAGE_KEYS.ADMIN_API,t.trim()),typeof ApiService<"u"&&ApiService.clearCache(),!0)},resetToDefault(t="main"){t==="main"?localStorage.removeItem(this.STORAGE_KEYS.MAIN_API):t==="admin"&&localStorage.removeItem(this.STORAGE_KEYS.ADMIN_API),typeof ApiService<"u"&&ApiService.clearCache()},getGajianConfig(){const t=localStorage.getItem(this.STORAGE_KEYS.GAJIAN_CONFIG);if(t)try{return JSON.parse(t)}catch(e){console.error("Error parsing gajian config",e)}return{targetDay:7,markups:[{minDays:29,rate:.2},{minDays:26,rate:.18},{minDays:23,rate:.16},{minDays:20,rate:.14},{minDays:17,rate:.12},{minDays:14,rate:.1},{minDays:11,rate:.08},{minDays:8,rate:.06},{minDays:3,rate:.04},{minDays:0,rate:.02}],defaultMarkup:.25}},setGajianConfig(t){localStorage.setItem(this.STORAGE_KEYS.GAJIAN_CONFIG,JSON.stringify(t))},getRewardConfig(){const t=localStorage.getItem(this.STORAGE_KEYS.REWARD_CONFIG);if(t)try{return JSON.parse(t)}catch(e){console.error("Error parsing reward config",e)}return{pointValue:1e4,minPoint:.1,manualOverrides:{}}},setRewardConfig(t){localStorage.setItem(this.STORAGE_KEYS.REWARD_CONFIG,JSON.stringify(t))},isStoreClosed(){return localStorage.getItem(this.STORAGE_KEYS.STORE_CLOSED)==="true"},setStoreClosed(t){localStorage.setItem(this.STORAGE_KEYS.STORE_CLOSED,t?"true":"false")},getAllConfig(){return{mainApi:this.getMainApiUrl(),adminApi:this.getAdminApiUrl(),gajian:this.getGajianConfig(),reward:this.getRewardConfig(),storeClosed:this.isStoreClosed()}}},ApiService={cache:new Map,pendingRequests:new Map,DEFAULT_CACHE_DURATION:3e5,MAX_RETRIES:3,INITIAL_RETRY_DELAY:1e3,clearCache(){this.cache.clear(),this.pendingRequests.clear(),console.log("\u{1F9F9} [ApiService] Cache cleared successfully")},clearCacheForEndpoint(t){const e=`${CONFIG.getMainApiUrl()}${t}`,n=this._generateCacheKey(e,{});this.cache.delete(n),console.log("\u{1F9F9} [ApiService] Cache cleared for endpoint:",t)},async fetch(t,e={}){const n=`${CONFIG.getMainApiUrl()}${t}`,a=this._generateCacheKey(n,e),o=e.cache!==!1;if(o&&this.cache.has(a)){const r=this.cache.get(a),d=e.cacheDuration||this.DEFAULT_CACHE_DURATION;if(Date.now()-r.timestamp<d)return console.log("\u{1F4E6} [ApiService] Using cached data:",t),r.data;console.log("\u23F0 [ApiService] Cache expired:",t),this.cache.delete(a)}if(this.pendingRequests.has(a))return console.log("\u23F3 [ApiService] Waiting for pending request:",t),this.pendingRequests.get(a);const s=this._fetchWithRetry(n,e);this.pendingRequests.set(a,s);try{const r=await s;return o&&(this.cache.set(a,{data:r,timestamp:Date.now()}),console.log("\u{1F4BE} [ApiService] Data cached:",t)),r}catch(r){throw console.error("\u274C [ApiService] Request failed:",t,r),r}finally{this.pendingRequests.delete(a)}},async _fetchWithRetry(t,e){const n=e.maxRetries||this.MAX_RETRIES;let a;for(let o=0;o<n;o++)try{console.log(`\u{1F310} [ApiService] Request attempt ${o+1}/${n}:`,t);const s=await fetch(t,{method:e.method||"GET",mode:"cors",headers:e.headers||{},body:e.body});if(s.status===429){if(o<n-1){const d=this._calculateBackoff(o);console.warn(`\u23F1\uFE0F [ApiService] Rate limited (429), retrying in ${d}ms...`),await this._sleep(d);continue}throw new Error("Rate limit exceeded. Please try again later.")}if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const r=await s.json();return console.log("\u2705 [ApiService] Request successful:",t),r}catch(s){if(a=s,o<n-1&&this._isRetryableError(s)){const r=this._calculateBackoff(o);console.warn(`\u{1F504} [ApiService] Retry ${o+1}/${n} after ${r}ms:`,s.message),await this._sleep(r);continue}break}throw a},_calculateBackoff(t){return this.INITIAL_RETRY_DELAY*Math.pow(2,t)},_isRetryableError:t=>t.message.includes("fetch")||t.message.includes("network")||t.message.includes("timeout"),_sleep:t=>new Promise(e=>setTimeout(e,t)),_generateCacheKey:(t,e)=>`${e.method||"GET"}:${t}:${e.body||""}`,getCacheStats(){const t={totalEntries:this.cache.size,pendingRequests:this.pendingRequests.size,entries:[]};for(const[e,n]of this.cache.entries()){const a=Date.now()-n.timestamp;t.entries.push({key:e,age:Math.round(a/1e3),size:JSON.stringify(n.data).length})}return t},async post(t,e,n={}){const a=new FormData;return a.append("json",JSON.stringify(e)),this.fetch(t,{...n,method:"POST",body:a,cache:!1})},async patch(t,e,n={}){return console.warn("\u26A0\uFE0F ApiService.patch() is deprecated. Use GASActions.update() instead."),this.fetch(t,{...n,method:"PATCH",headers:{"Content-Type":"application/json",...n.headers},body:JSON.stringify(e),cache:!1})},async get(t,e={}){return this.fetch(t,{...e,method:"GET"})}};window.ApiService=ApiService;const GASActions={async post(t){const e=CONFIG.getAdminApiUrl(),n=new FormData;n.append("json",JSON.stringify(t));const a=await fetch(e,{method:"POST",body:n});if(!a.ok){const s=await a.text();throw new Error(`HTTP ${a.status}: ${s}`)}const o=await a.json();if(o.error)throw new Error(o.error);return o},async create(t,e){return this.post({action:"create",sheet:t,data:e})},async update(t,e,n){return this.post({action:"update",sheet:t,id:e,data:n})},async delete(t,e){return this.post({action:"delete",sheet:t,id:e})}};async function apiPost(t,e){const n=new URLSearchParams;n.append("json",JSON.stringify(e));const a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return a.json()}async function apiGet(t,e={}){const n=new URLSearchParams(e).toString(),a=n?`${t}?${n}`:t,o=await fetch(a);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return o.json()}function getGajianConfig(){return typeof CONFIG<"u"&&CONFIG.getGajianConfig?CONFIG.getGajianConfig():{targetDay:7,markups:[{minDays:29,rate:.2},{minDays:26,rate:.18},{minDays:23,rate:.16},{minDays:20,rate:.14},{minDays:17,rate:.12},{minDays:14,rate:.1},{minDays:11,rate:.08},{minDays:8,rate:.06},{minDays:3,rate:.04},{minDays:0,rate:.02}],defaultMarkup:.25}}function calculateGajianPrice(t){const e=getGajianConfig(),n=new Date,a=new Date(n.getTime()+252e5);let o=new Date(a.getFullYear(),a.getMonth(),e.targetDay);a.getDate()>e.targetDay&&o.setMonth(o.getMonth()+1);const s=o-a,r=Math.ceil(s/864e5);let d=e.defaultMarkup;const l=[...e.markups].sort((i,m)=>m.minDays-i.minDays);for(const i of l)if(r>=i.minDays){d=i.rate;break}return{price:Math.round(t*(1+d)),daysLeft:r,markupPercent:(100*d).toFixed(0)}}function calculateRewardPoints(t,e){let n={pointValue:1e4,minPoint:.1,manualOverrides:{}};if(typeof CONFIG<"u"&&CONFIG.getRewardConfig&&(n=CONFIG.getRewardConfig()),e&&n.manualOverrides&&n.manualOverrides[e]!==void 0)return parseFloat(n.manualOverrides[e]);let a=0;return t>=n.pointValue?a=Math.floor(t/n.pointValue):t>0&&(a=t/n.pointValue),a<n.minPoint&&a>0&&(a=n.minPoint),Math.round(10*a)/10}typeof window<"u"&&(window.calculateGajianPrice=calculateGajianPrice,window.calculateRewardPoints=calculateRewardPoints);function calculateTieredPrice(t,e,n){if(!n)return t;let a=[];if(typeof n=="string")try{a=JSON.parse(n)}catch(r){return console.error("Error parsing tiered prices:",r),t}else a=n;if(!Array.isArray(a)||a.length===0)return t;const o=[...a].sort((r,d)=>d.min_qty-r.min_qty);let s=t;for(const r of o)if(e>=r.min_qty){s=r.price;break}return s}function getNextTierInfo(t,e){if(!e)return null;let n=[];if(typeof e=="string")try{n=JSON.parse(e)}catch{return null}else n=e;if(!Array.isArray(n)||n.length===0)return null;const a=[...n].sort((o,s)=>o.min_qty-s.min_qty);for(const o of a)if(t<o.min_qty)return o;return null}function updateTieredPricingUI(t,e=1){const n=document.getElementById("tiered-pricing-ui"),a=document.getElementById("price-tiers-table"),o=document.getElementById("current-tier-badge"),s=document.getElementById("tier-progress-container"),r=document.getElementById("tier-progress-text"),d=document.getElementById("tier-progress-bar"),l=document.getElementById("tier-progress-percent");if(!n||!t.grosir)return void(n&&n.classList.add("hidden"));let i=[];try{i=typeof t.grosir=="string"?JSON.parse(t.grosir):t.grosir}catch{return void n.classList.add("hidden")}if(!Array.isArray(i)||i.length===0)return void n.classList.add("hidden");n.classList.remove("hidden");const m=[...i].sort((u,g)=>u.min_qty-g.min_qty),h=calculateTieredPrice(t.harga,e,i),p=h<t.harga;o&&(p?(o.classList.remove("hidden"),o.innerText="Harga Grosir Aktif"):o.classList.add("hidden")),a&&(a.innerHTML=m.map(u=>{const g=e>=u.min_qty&&h===u.price;return`
                <div class="${g?"bg-blue-600 border-blue-600":"bg-white border-blue-100"} border rounded-xl p-2 text-center transition-all duration-300">
                    <p class="text-[8px] ${g?"text-blue-100":"text-blue-500"} font-bold uppercase leading-tight">Min. ${u.min_qty}</p>
                    <p class="text-xs ${g?"text-white":"text-blue-800"} font-black">Rp ${u.price.toLocaleString("id-ID")}</p>
                </div>
            `}).join(""));const c=getNextTierInfo(e,i);if(c&&s){s.classList.remove("hidden");const u=c.min_qty-e,g=[...m].reverse().find(b=>b.min_qty<=e),f=g?g.min_qty:0,y=c.min_qty-f,x=(e-f)/y*100;r&&(r.innerHTML=`Beli <span class="font-bold">${u} lagi</span> untuk harga <span class="font-bold">Rp ${c.price.toLocaleString("id-ID")}</span>`),d&&(d.style.width=`${x}%`),l&&(l.innerText=`${Math.round(x)}%`)}else s&&s.classList.add("hidden")}typeof window<"u"&&(window.calculateTieredPrice=calculateTieredPrice,window.getNextTierInfo=getNextTierInfo,window.updateTieredPricingUI=updateTieredPricingUI);var sanitizeUrl=window.FrontendSanitize&&window.FrontendSanitize.sanitizeUrl||(t=>String(t||""));let currentSlideIndex=0,totalSlides=0,sliderImages=[];function initializeSlider(t){if(!t||t.length===0)return void console.warn("\u26A0\uFE0F No images provided to slider");sliderImages=t.filter(o=>o&&o.trim()!==""),totalSlides=sliderImages.length,currentSlideIndex=0;const e=document.getElementById("modal-slider"),n=document.getElementById("slider-dots"),a=document.getElementById("slider-skeleton");e&&n?(e.innerHTML="",n.innerHTML="",sliderImages.forEach((o,s)=>{const r=document.createElement("img");r.src=sanitizeUrl(o,"https://placehold.co/300x200?text=Produk"),r.setAttribute("data-fallback-src","https://placehold.co/300x200?text=Produk"),r.alt=`Slide ${s+1}`,r.className="absolute inset-0 w-full h-full object-cover transition-opacity duration-500 "+(s===0?"opacity-100":"opacity-0"),r.onload=function(){a&&a.classList.add("hidden")},e.appendChild(r)}),sliderImages.forEach((o,s)=>{const r=document.createElement("button");r.className="w-2 h-2 rounded-full transition-all "+(s===0?"bg-white w-6":"bg-white/50 hover:bg-white/75"),r.onclick=()=>goToSlide(s),r.title=`Go to slide ${s+1}`,n.appendChild(r)}),updateSliderCounter(),setupKeyboardNavigation(),setupTouchNavigation(),console.log(`\u2705 Slider initialized with ${totalSlides} images`)):console.error("\u274C Slider containers not found")}function updateSliderCounter(){const t=document.getElementById("slider-counter");t&&(t.textContent=`${currentSlideIndex+1} / ${totalSlides}`)}function goToSlide(t){if(t<0||t>=totalSlides)return;const e=document.querySelectorAll("#modal-slider img"),n=document.querySelectorAll("#slider-dots button");e.forEach((a,o)=>{a.classList.toggle("opacity-100",o===t),a.classList.toggle("opacity-0",o!==t)}),n.forEach((a,o)=>{o===t?(a.classList.add("bg-white","w-6"),a.classList.remove("bg-white/50","hover:bg-white/75")):(a.classList.remove("bg-white","w-6"),a.classList.add("bg-white/50","hover:bg-white/75"))}),currentSlideIndex=t,updateSliderCounter()}function nextSlide(){totalSlides!==0&&goToSlide((currentSlideIndex+1)%totalSlides)}function prevSlide(){totalSlides!==0&&goToSlide((currentSlideIndex-1+totalSlides)%totalSlides)}function setupKeyboardNavigation(){const t=e=>{e.key==="ArrowLeft"?prevSlide():e.key==="ArrowRight"&&nextSlide()};document.removeEventListener("keydown",t),document.addEventListener("keydown",t)}function setupTouchNavigation(){const t=document.getElementById("modal-slider");if(!t)return;let e=0,n=0;t.addEventListener("touchstart",a=>{e=a.changedTouches[0].clientX}),t.addEventListener("touchend",a=>{n=a.changedTouches[0].clientX,function(){const o=e-n;Math.abs(o)>50&&(o>0?nextSlide():prevSlide())}()})}function initializeSliderFallback(){const t=document.getElementById("modal-slider"),e=document.querySelector("#modal-slider img");t&&!e&&(t.innerHTML=`
            <img 
                src="https://placehold.co/300x200?text=Produk" 
                alt="Produk" 
                class="w-full h-full object-cover"
                data-fallback-src="https://placehold.co/300x200?text=Produk"
            >
        `);const n=document.getElementById("slider-counter");n&&(n.textContent="1 / 1")}console.log("\u2705 Image Slider Module Loaded");var escapeHtml=window.FrontendSanitize&&window.FrontendSanitize.escapeHtml||(t=>String(t||"")),sanitizeUrl=window.FrontendSanitize&&window.FrontendSanitize.sanitizeUrl||(t=>String(t||"")),ensureImageFallbackHandler=window.FrontendSanitize&&window.FrontendSanitize.ensureImageFallbackHandler||(()=>{});class PromotionalBannerCarousel{constructor(){this.banners=[],this.currentIndex=0,this.autoRotateInterval=null,this.isTransitioning=!1,this.autoRotateDelay=5e3,this.init()}async init(){await this.fetchBanners(),this.banners.length>0?(ensureImageFallbackHandler(),this.render(),this.setupEventListeners(),this.startAutoRotate()):this.hideContainer()}async fetchBanners(){try{const e=CONFIG.getMainApiUrl();console.log("\u{1F504} [PROMO-BANNER] Fetching banners from:",e);const n=await fetch(`${e}?sheet=banners`);if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const a=await n.json();console.log("\u{1F4E5} [PROMO-BANNER] Received banners:",a);const o=new Date;this.banners=a.filter(s=>{if(s.status!=="active")return!1;if(s.start_date){const r=new Date(s.start_date);if(o<r)return!1}if(s.end_date){const r=new Date(s.end_date);if(o>r)return!1}return!0}),console.log(`\u2705 [PROMO-BANNER] Loaded ${this.banners.length} active banners`)}catch(e){console.error("\u274C [PROMO-BANNER] Error fetching banners:",e),this.banners=[]}}hideContainer(){const e=document.getElementById("promo-banner-carousel-container");e&&(e.style.display="none")}render(){const e=document.getElementById("promo-banner-carousel-container");if(!e)return void console.warn("\u26A0\uFE0F [PROMO-BANNER] Container not found");e.style.display="block";const n=this.banners.length>1;e.innerHTML=`
            <div class="promo-banner-wrapper">
                ${n?`
                <button class="promo-carousel-nav promo-carousel-prev" id="promo-carousel-prev" aria-label="Previous">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>
                `:""}
                
                <div class="promo-carousel-track-container">
                    <div class="promo-carousel-track" id="promo-carousel-track">
                        ${this.banners.map((a,o)=>this.renderBannerSlide(a,o)).join("")}
                    </div>
                </div>
                
                ${n?`
                <button class="promo-carousel-nav promo-carousel-next" id="promo-carousel-next" aria-label="Next">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </button>
                `:""}
            </div>
            
            ${n?`
            <div class="promo-carousel-dots" id="promo-carousel-dots">
                ${this.banners.map((a,o)=>`
                    <button class="promo-carousel-dot ${o===0?"active":""}" data-index="${o}" aria-label="Go to slide ${o+1}"></button>
                `).join("")}
            </div>
            `:""}
        `,this.updateCarousel()}renderBannerSlide(e,n){const a=e.cta_url&&e.cta_url.trim()!=="",o=e.title&&e.title.trim()!==""||e.subtitle&&e.subtitle.trim()!==""||e.cta_text&&e.cta_text.trim()!=="",s=escapeHtml(e.title||""),r=escapeHtml(e.subtitle||""),d=escapeHtml(e.cta_text||""),l=sanitizeUrl(e.cta_url,"#"),i=sanitizeUrl(e.image_url,"https://placehold.co/1200x400?text=Banner+Promosi");return a&&typeof e.cta_url=="string"&&e.cta_url.startsWith("#produk-")&&console.log(`[Banner] Creating deep link for: ${e.title||"Untitled"} -> ${e.cta_url}`),`
            <div class="promo-carousel-slide" data-index="${n}">
                <div class="promo-banner-card">
                    ${a?`<a href="${l}" class="promo-banner-link">`:""}
                        <div class="promo-banner-image-container lazy-image-wrapper">
                            <div class="skeleton skeleton-banner"></div>
                            <img src="${i}" alt="${s||"Banner Promosi"}" class="promo-banner-image" loading="${n===0?"eager":"lazy"}" data-fallback-src="https://placehold.co/1200x400?text=Banner+Promosi" onload="this.classList.add('loaded'); this.previousElementSibling.style.display='none';">
                        </div>
                        ${o?`
                        <div class="promo-banner-caption">
                            ${e.title?`<h3 class="promo-banner-title">${s}</h3>`:""}
                            ${e.subtitle?`<p class="promo-banner-subtitle">${r}</p>`:""}
                            ${e.cta_text&&a?`<button class="promo-cta-button">${d}</button>`:""}
                        </div>
                        `:""}
                    ${a?"</a>":""}
                </div>
            </div>
        `}setupEventListeners(){const e=document.getElementById("promo-carousel-prev"),n=document.getElementById("promo-carousel-next"),a=document.querySelectorAll(".promo-carousel-dot");e&&e.addEventListener("click",()=>{this.prev(),this.stopAutoRotate(),this.startAutoRotate()}),n&&n.addEventListener("click",()=>{this.next(),this.stopAutoRotate(),this.startAutoRotate()}),a.forEach(r=>{r.addEventListener("click",d=>{const l=parseInt(d.target.dataset.index);this.goToSlide(l),this.stopAutoRotate(),this.startAutoRotate()})});const o=document.getElementById("promo-carousel-track");if(o){let r=0,d=0,l=!1;o.addEventListener("touchstart",i=>{r=i.touches[0].clientX,l=!0,this.stopAutoRotate()}),o.addEventListener("touchmove",i=>{l&&(d=i.touches[0].clientX)}),o.addEventListener("touchend",()=>{if(!l)return;l=!1;const i=r-d;Math.abs(i)>50&&(i>0?this.next():this.prev()),this.startAutoRotate()})}const s=document.getElementById("promo-banner-carousel-container");s&&window.innerWidth>=768&&(s.addEventListener("mouseenter",()=>{this.stopAutoRotate()}),s.addEventListener("mouseleave",()=>{this.startAutoRotate()}))}updateCarousel(){const e=document.getElementById("promo-carousel-track"),n=document.querySelectorAll(".promo-carousel-dot"),a=document.getElementById("promo-carousel-prev"),o=document.getElementById("promo-carousel-next");if(!e)return;const s=-100*this.currentIndex;e.style.transform=`translateX(${s}%)`,n.forEach((r,d)=>{r.classList.toggle("active",d===this.currentIndex)}),a&&o&&(a.style.opacity=this.currentIndex===0?"0.5":"1",o.style.opacity=this.currentIndex>=this.banners.length-1?"0.5":"1")}next(){this.isTransitioning||(this.currentIndex>=this.banners.length-1?this.currentIndex=0:this.currentIndex++,this.isTransitioning=!0,this.updateCarousel(),setTimeout(()=>{this.isTransitioning=!1},500))}prev(){this.isTransitioning||(this.currentIndex<=0?this.currentIndex=this.banners.length-1:this.currentIndex--,this.isTransitioning=!0,this.updateCarousel(),setTimeout(()=>{this.isTransitioning=!1},500))}goToSlide(e){this.isTransitioning||e===this.currentIndex||(this.currentIndex=e,this.isTransitioning=!0,this.updateCarousel(),setTimeout(()=>{this.isTransitioning=!1},500))}startAutoRotate(){this.banners.length<=1||(this.stopAutoRotate(),this.autoRotateInterval=setInterval(()=>{this.next()},this.autoRotateDelay))}stopAutoRotate(){this.autoRotateInterval&&(clearInterval(this.autoRotateInterval),this.autoRotateInterval=null)}async refresh(){this.stopAutoRotate(),await this.fetchBanners(),this.currentIndex=0,this.banners.length>0?(this.render(),this.setupEventListeners(),this.startAutoRotate()):this.hideContainer()}}let promoBannerCarousel,promoResizeTimeout;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{promoBannerCarousel=new PromotionalBannerCarousel}):promoBannerCarousel=new PromotionalBannerCarousel,window.addEventListener("resize",()=>{clearTimeout(promoResizeTimeout),promoResizeTimeout=setTimeout(()=>{promoBannerCarousel&&promoBannerCarousel.updateCarousel()},250)});var escapeHtml=window.FrontendSanitize&&window.FrontendSanitize.escapeHtml||(t=>String(t||"")),sanitizeUrl=window.FrontendSanitize&&window.FrontendSanitize.sanitizeUrl||(t=>String(t||"")),ensureImageFallbackHandler=window.FrontendSanitize&&window.FrontendSanitize.ensureImageFallbackHandler||(()=>{});class BundleCarousel{constructor(){this.bundles=[],this.currentIndex=0,this.autoRotateInterval=null,this.isTransitioning=!1,this.init()}async init(){await this.fetchBundles(),this.bundles.length>0&&(ensureImageFallbackHandler(),this.render(),this.setupEventListeners(),this.startAutoRotate())}async fetchBundles(){try{const e=await fetch(CONFIG.getMainApiUrl()),n=await e.json();this.bundles=n.filter(a=>a.kategori&&a.kategori.toLowerCase().includes("paket")).map(a=>{const o=parseInt(a.harga_cash||a.harga||0),s=parseInt(a.harga_gajian||a.hargaGajian||0),r=s>0?s:typeof calculateGajianPrice=="function"?calculateGajianPrice(o).price:o;return{...a,harga:o,hargaGajian:r,hargaCoret:parseInt(a.harga_coret||a.hargaCoret||0),stok:parseInt(a.stok_tersedia||a.stok||0),gambar:a.gambar||"https://placehold.co/300x200?text=Produk"}}),console.log(`\u2705 Loaded ${this.bundles.length} bundle packages`)}catch(e){console.error("\u274C Error fetching bundles:",e),this.bundles=[]}}render(){const e=document.getElementById("bundle-carousel-container");e&&this.bundles.length!==0?(e.style.display="block",e.innerHTML=`
            <div class="bundle-carousel-wrapper">
                <button class="carousel-nav carousel-prev" id="carousel-prev" aria-label="Previous">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>
                
                <div class="carousel-track-container">
                    <div class="carousel-track" id="carousel-track">
                        ${this.bundles.map((n,a)=>this.renderProductCard(n,a)).join("")}
                    </div>
                </div>
                
                <button class="carousel-nav carousel-next" id="carousel-next" aria-label="Next">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </button>
            </div>
            
            <div class="carousel-dots" id="carousel-dots">
                ${this.bundles.map((n,a)=>`
                    <button class="carousel-dot ${a===0?"active":""}" data-index="${a}" aria-label="Go to slide ${a+1}"></button>
                `).join("")}
            </div>
        `,this.updateCarousel()):e&&(e.style.display="none")}renderProductCard(e,n){const a=escapeHtml(e.nama||""),o=Number.isFinite(e.stok)?e.stok:parseInt(e.stok||0);let s="";s=o>5?'<span class="bg-green-100 text-green-700 text-[10px] px-2 py-0.5 rounded-full font-bold">Stok Tersedia</span>':o>0?`<span class="bg-orange-100 text-orange-700 text-[10px] px-2 py-0.5 rounded-full font-bold">Stok Terbatas (${o})</span>`:'<span class="bg-red-100 text-red-700 text-[10px] px-2 py-0.5 rounded-full font-bold">Stok Habis</span>';const r=(e.gambar?e.gambar.split(","):[])[0]||"https://placehold.co/300x200?text=Produk",d=sanitizeUrl(r,"https://placehold.co/300x200?text=Produk"),l=typeof calculateRewardPoints=="function"?calculateRewardPoints(e.harga,e.nama):0;let i="";if(e.hargaCoret>e.harga){const h=Math.round((e.hargaCoret-e.harga)/e.hargaCoret*100);i=`
                <div class="flex items-center gap-1 mb-0.5">
                    <span class="text-[10px] text-gray-400 line-through">Rp ${e.hargaCoret.toLocaleString("id-ID")}</span>
                    <span class="bg-red-500 text-white text-[8px] px-1.5 py-0.5 rounded font-bold">-${h}%</span>
                </div>
            `}const m=e.variations&&e.variations.length>0;return`
            <div class="carousel-slide" data-index="${n}">
                <div class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition duration-300 relative h-full">
                    <div class="absolute top-3 left-3 z-10 flex flex-col gap-2">
                        <div class="bg-amber-400 text-white text-[10px] font-bold px-2 py-1 rounded-lg shadow-sm flex items-center gap-1">
                            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                            +${l} Poin
                        </div>
                    </div>
                    <img src="${d}" alt="${a}" data-action="open-detail" data-index="${n}" class="w-full h-48 object-cover cursor-pointer hover:opacity-90 transition-opacity ${o===0?"grayscale opacity-60":""}" data-fallback-src="https://placehold.co/300x200?text=Produk">
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="text-lg font-bold text-gray-800">${a}</h4>
                            ${s}
                        </div>
                        <div class="flex justify-between items-center mb-4">
                            <button data-action="share-product" data-index="${n}" class="text-green-600 hover:text-green-700 flex items-center gap-1 text-xs font-medium">
                                <span>Share</span>
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.335-1.662c1.72.937 3.659 1.432 5.631 1.433h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                            </button>
                        </div>
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="bg-green-50 p-3 rounded-lg">
                                <p class="text-[10px] text-green-600 font-bold uppercase">Harga Cash</p>
                                <div class="flex flex-col">
                                    ${i}
                                    <p class="text-lg font-bold text-green-700">Rp ${e.harga.toLocaleString("id-ID")}</p>
                                </div>
                            </div>
                            <div class="bg-blue-50 p-3 rounded-lg">
                                <p class="text-[10px] text-blue-600 font-bold uppercase">Bayar Gajian</p>
                                <div class="flex flex-col">
                                    <p class="text-[8px] text-blue-400 mb-0.5">Harga Per Tgl ${new Date().toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"}).replace(/\//g,"-")}</p>
                                    <p class="text-lg font-bold text-blue-700">Rp ${e.hargaGajian.toLocaleString("id-ID")}</p>
                                </div>
                            </div>
                        </div>
                        ${m?`
                        <button data-action="open-detail" data-index="${n}" class="w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 rounded-xl transition flex items-center justify-center gap-2 mb-3">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                            Pilih Variasi
                        </button>
                        `:`
                        <button data-action="add-to-cart" data-index="${n}" ${o===0?"disabled":""} class="w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-300 text-white font-bold py-3 rounded-xl transition flex items-center justify-center gap-2 mb-3">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                            Tambah ke Keranjang
                        </button>
                        `}
                        <div class="grid grid-cols-2 gap-2">
                            <button data-action="open-detail" data-index="${n}" class="bg-gray-100 hover:bg-gray-200 text-gray-600 font-bold py-2 rounded-lg text-sm transition">Rincian</button>
                            <button data-action="direct-order" data-index="${n}" ${o===0?"disabled":""} class="bg-green-100 hover:bg-green-200 text-green-700 font-bold py-2 rounded-lg text-sm transition">Beli Sekarang</button>
                        </div>
                    </div>
                </div>
            </div>
        `}setupEventListeners(){const e=document.getElementById("carousel-prev"),n=document.getElementById("carousel-next"),a=document.querySelectorAll(".carousel-dot"),o=document.getElementById("bundle-carousel-container");e&&e.addEventListener("click",()=>this.prev()),n&&n.addEventListener("click",()=>this.next()),a.forEach(r=>{r.addEventListener("click",d=>{const l=parseInt(d.target.dataset.index);this.goToSlide(l)})}),o&&o.addEventListener("click",r=>{const d=r.target.closest("[data-action]");if(!d||!o.contains(d))return;const l=d.dataset.action,i=parseInt(d.dataset.index,10);if(!Number.isNaN(i))if(l!=="open-detail")if(l!=="add-to-cart")if(l!=="direct-order"){if(l==="share-product"){const m=this.bundles[i];m&&typeof shareProduct=="function"&&shareProduct(m.nama||"")}}else this.directOrderProduct(i);else this.addProductToCart(i,r);else this.openProductDetail(i)});const s=document.getElementById("carousel-track");if(s){let r=0,d=0,l=!1;s.addEventListener("touchstart",i=>{r=i.touches[0].clientX,l=!0,this.stopAutoRotate()}),s.addEventListener("touchmove",i=>{l&&(d=i.touches[0].clientX)}),s.addEventListener("touchend",()=>{if(!l)return;l=!1;const i=r-d;Math.abs(i)>50&&(i>0?this.next():this.prev()),this.startAutoRotate()})}}updateCarousel(){const e=document.getElementById("carousel-track"),n=document.querySelectorAll(".carousel-dot"),a=document.getElementById("carousel-prev"),o=document.getElementById("carousel-next");if(!e)return;const s=window.innerWidth<768,r=s?1:2,d=s?90:45,l=-this.currentIndex*d+5;e.style.transform=`translateX(${l}%)`,n.forEach((i,m)=>{i.classList.toggle("active",m===this.currentIndex)}),a&&o&&(a.style.opacity=this.currentIndex===0?"0.5":"1",o.style.opacity=this.currentIndex>=this.bundles.length-r?"0.5":"1")}next(){if(this.isTransitioning)return;const e=window.innerWidth<768?1:2,n=this.bundles.length-e;this.currentIndex>=n?this.currentIndex=0:this.currentIndex++,this.isTransitioning=!0,this.updateCarousel(),setTimeout(()=>{this.isTransitioning=!1},500)}prev(){if(this.isTransitioning)return;const e=window.innerWidth<768?1:2,n=this.bundles.length-e;this.currentIndex<=0?this.currentIndex=n:this.currentIndex--,this.isTransitioning=!0,this.updateCarousel(),setTimeout(()=>{this.isTransitioning=!1},500)}goToSlide(e){this.isTransitioning||(this.currentIndex=e,this.isTransitioning=!0,this.updateCarousel(),setTimeout(()=>{this.isTransitioning=!1},500),this.stopAutoRotate(),this.startAutoRotate())}startAutoRotate(){this.stopAutoRotate(),this.autoRotateInterval=setInterval(()=>{this.next()},3e3)}stopAutoRotate(){this.autoRotateInterval&&(clearInterval(this.autoRotateInterval),this.autoRotateInterval=null)}openProductDetail(e){const n=this.bundles[e];if(!n)return;this.stopAutoRotate(),typeof showDetail=="function"?showDetail(n):console.error("showDetail function not found");const a=document.getElementById("detail-modal");if(a){const o=new MutationObserver(s=>{s.forEach(r=>{r.attributeName==="class"&&a.classList.contains("hidden")&&(this.startAutoRotate(),o.disconnect())})});o.observe(a,{attributes:!0})}}addProductToCart(e,n){const a=this.bundles[e];a&&(typeof addToCart=="function"?addToCart(a,n):console.error("addToCart function not found"))}directOrderProduct(e){const n=this.bundles[e];n&&(this.stopAutoRotate(),typeof directOrder=="function"?directOrder(n):console.error("directOrder function not found"))}async refresh(){await this.fetchBundles(),this.currentIndex=0,this.render(),this.setupEventListeners(),this.startAutoRotate()}}let bundleCarousel,bundleResizeTimeout;document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{bundleCarousel=new BundleCarousel}):bundleCarousel=new BundleCarousel,window.addEventListener("resize",()=>{clearTimeout(bundleResizeTimeout),bundleResizeTimeout=setTimeout(()=>{bundleCarousel&&bundleCarousel.updateCarousel()},250)}),window.FrontendSanitize={escapeHtml:function(t){return String(t||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},sanitizeUrl:function(t,e=""){if(!t)return e;const n=String(t).trim();return/^(https?:\/\/|\/(?!\/)|\.\/|\.\.\/|#)/i.test(n)?n:e},ensureImageFallbackHandler:function(){window.__imageFallbackHandlerAdded||(window.__imageFallbackHandlerAdded=!0,document.addEventListener("error",t=>{const e=t.target;if(!e||e.tagName!=="IMG")return;const n=e.getAttribute("data-fallback-src"),a=e.getAttribute("data-fallback-action");n&&e.src!==n?e.src=n:a==="hide"&&(e.style.display="none")},!0))}},window.sanitizeUrl||(window.sanitizeUrl=window.FrontendSanitize.sanitizeUrl),window.ensureImageFallbackHandler||(window.ensureImageFallbackHandler=window.FrontendSanitize.ensureImageFallbackHandler),window.AdminSanitize||(window.AdminSanitize=window.FrontendSanitize);var escapeHtml=window.FrontendSanitize&&window.FrontendSanitize.escapeHtml||(t=>String(t||"")),sanitizeUrl=window.FrontendSanitize&&window.FrontendSanitize.sanitizeUrl||(t=>String(t||"")),ensureImageFallbackHandler=window.FrontendSanitize&&window.FrontendSanitize.ensureImageFallbackHandler||(()=>{});function getApiUrl(){const t=CONFIG.getMainApiUrl();return console.log("Using API URL:",t),t}ensureImageFallbackHandler();let API_URL=getApiUrl();function refreshApiUrl(){const t=API_URL;API_URL=getApiUrl(),console.log("Old API URL:",t),console.log("New API URL:",API_URL),t!==API_URL&&(console.log("\u{1F504} API URL changed, clearing cache and reloading..."),typeof ApiService<"u"&&ApiService.clearCache()),fetchProducts()}let cart=JSON.parse(localStorage.getItem("sembako_cart"))||[],allProducts=[],currentCategory="Semua",currentPage=1;const itemsPerPage=12;let filteredProducts=[],storeClosed=CONFIG.isStoreClosed(),selectedVariation=null,currentModalProduct=null;function normalizePhoneNumber(t){if(!t)return null;let e=String(t).replace(/[^0-9]/g,"");return e.startsWith("62")&&(e="0"+e.substring(2)),e.startsWith("8")&&!e.startsWith("08")&&(e="0"+e),!e.startsWith("08")||e.length<10||e.length>13?null:e}function createSlug(t){return t?t.toLowerCase().replace(/[^\w\s-]/g,"").trim().replace(/[-\s]+/g,"-"):""}function ensureProductId(t,e){const n=t.id||t.sku||t.slug||createSlug(t.nama)||"product";return t.id||t.sku?String(n):`${n}-${e}`}function findProductById(t){return t&&allProducts.find(e=>String(e.productId)===String(t))||null}async function fetchProducts(){try{const t=await ApiService.get("?sheet=products",{cacheDuration:3e5});console.log("Products received:",t),allProducts=t.map((e,n)=>{const a=parseInt(e.harga)||0,o=typeof calculateGajianPrice=="function"?calculateGajianPrice(a):{price:a,daysLeft:0,markupPercent:0};let s=e.kategori||"Bahan Pokok";e.kategori||(a>=15e4?s="Paket Lengkap":a>=5e4&&(s="Paket Hemat"));let r=[];if(e.variasi)try{r=JSON.parse(e.variasi)}catch(i){console.error("Error parsing variations for product:",e.id,i)}const d=e.slug||createSlug(e.nama),l=ensureProductId({...e,slug:d},n);return{...e,slug:d,productId:l,harga:a,hargaCoret:parseInt(e.harga_coret)||0,hargaGajian:o.price,stok:parseInt(e.stok)||0,category:s,deskripsi:e.deskripsi&&e.deskripsi.trim()!==""?e.deskripsi:"Kualitas Terjamin, Stok Selalu Baru, Harga Kompetitif",variations:r}}),renderCategoryFilters(),filterProducts(),updateCartUI(),checkStoreStatus(),startNotificationLoop()}catch(t){console.error("Error fetching products:",t);const e=document.getElementById("product-grid");e&&(e.innerHTML='<p class="text-center col-span-full text-red-500">Gagal memuat produk. Silakan coba lagi nanti.</p>')}}function renderCategoryFilters(){const t=document.getElementById("category-filters");if(!t||!allProducts||allProducts.length===0)return;console.log("\u{1F3F7}\uFE0F Rendering category filters...");const e=new Set;allProducts.forEach(o=>{o.category&&o.category.trim()!==""&&e.add(o.category.trim())});const n=Array.from(e).sort();console.log("\u{1F4CA} Categories found:",n);let a='<button type="button" data-action="set-category" data-category="Semua" class="filter-btn active snap-start flex-shrink-0 px-6 py-2 rounded-full border-2 border-green-500 bg-green-50 text-green-700 text-sm font-bold transition hover:border-green-600 hover:bg-green-100">Semua</button>';n.forEach(o=>{const s=escapeHtml(o);a+=`<button type="button" data-action="set-category" data-category="${s}" class="filter-btn snap-start flex-shrink-0 px-6 py-2 rounded-full border-2 border-gray-300 bg-white text-gray-700 text-sm font-bold transition hover:border-green-500 hover:bg-green-50">${s}</button>`}),t.innerHTML=a,console.log("\u2705 Category filters rendered:",n.length,"categories"),initCategoryCarouselScroll()}function initCategoryCarouselScroll(){const t=document.getElementById("category-filters");if(!t)return;t.addEventListener("wheel",o=>{o.deltaY!==0&&(o.preventDefault(),t.scrollLeft+=o.deltaY)},{passive:!1});let e,n,a=!1;t.addEventListener("mousedown",o=>{o.target.classList.contains("filter-btn")||(a=!0,t.style.cursor="grabbing",e=o.pageX-t.offsetLeft,n=t.scrollLeft)}),t.addEventListener("mouseleave",()=>{a=!1,t.style.cursor="grab"}),t.addEventListener("mouseup",()=>{a=!1,t.style.cursor="grab"}),t.addEventListener("mousemove",o=>{if(!a)return;o.preventDefault();const s=2*(o.pageX-t.offsetLeft-e);t.scrollLeft=n-s}),t.style.cursor="grab",updateCategoryArrowsVisibility(),t.addEventListener("scroll",updateCategoryArrowsVisibility)}function scrollCategoryCarousel(t){const e=document.getElementById("category-filters");e&&(t==="left"?e.scrollLeft-=300:t==="right"&&(e.scrollLeft+=300))}function updateCategoryArrowsVisibility(){const t=document.getElementById("category-filters"),e=document.getElementById("category-scroll-left"),n=document.getElementById("category-scroll-right");if(!t||!e||!n)return;const a=t.scrollLeft<=10,o=t.scrollLeft+t.clientWidth>=t.scrollWidth-10;a?e.classList.add("opacity-0","pointer-events-none"):e.classList.remove("opacity-0","pointer-events-none"),o?n.classList.add("opacity-0","pointer-events-none"):n.classList.remove("opacity-0","pointer-events-none")}function findProductBySlug(t){return t&&allProducts&&allProducts.length!==0?allProducts.find(e=>e.slug===t):null}function renderProducts(t){const e=document.getElementById("product-grid");if(!e)return;if(t.length===0)return e.innerHTML='<p class="text-center col-span-full text-gray-500 py-10">Tidak ada produk yang ditemukan.</p>',void(document.getElementById("pagination-container").innerHTML="");const n=Math.ceil(t.length/12);currentPage>n&&(currentPage=n||1);const a=12*(currentPage-1),o=a+12,s=t.slice(a,o);e.innerHTML="",s.forEach(r=>{let d="";d=r.stok>10?'<span class="bg-green-100 text-green-700 text-[10px] px-2 py-0.5 rounded-full font-bold">Stok Tersedia</span>':r.stok>5?`<span class="bg-yellow-100 text-yellow-700 text-[10px] px-2 py-0.5 rounded-full font-bold">Stok Menipis (${r.stok})</span>`:r.stok>0?`<span class="bg-orange-100 text-orange-700 text-[10px] px-2 py-0.5 rounded-full font-bold">Hanya sisa ${r.stok}</span>`:'<span class="bg-red-100 text-red-700 text-[10px] px-2 py-0.5 rounded-full font-bold">Stok Habis</span>';const l=(r.gambar?r.gambar.split(","):[])[0]||"https://placehold.co/300x200?text=Produk",i=sanitizeUrl(l,"https://placehold.co/300x200?text=Produk"),m=calculateRewardPoints(r.harga,r.nama);let h="",p=!1;if(r.grosir)try{const y=JSON.parse(r.grosir);Array.isArray(y)&&y.length>0&&(p=!0,h=`
                        <div class="grid grid-cols-3 gap-2 mb-3">
                            ${[...y].sort((b,w)=>b.min_qty-w.min_qty).map(b=>`
                        <div class="bg-green-50 border border-green-100 rounded-lg p-1.5 text-center">
                            <p class="text-[8px] text-green-600 font-bold uppercase leading-tight">Min. ${b.min_qty}</p>
                            <p class="text-[10px] text-green-700 font-black">Rp ${b.price.toLocaleString("id-ID")}</p>
                        </div>
                    `).join("")}
                        </div>
                    `)}catch(y){console.error("Error parsing grosir data for product:",r.id,y)}let c="";if(r.hargaCoret>r.harga){const y=Math.round((r.hargaCoret-r.harga)/r.hargaCoret*100);c=`
                <div class="flex items-center gap-1 mb-0.5">
                    <span class="text-[10px] text-gray-400 line-through">Rp ${r.hargaCoret.toLocaleString("id-ID")}</span>
                    <span class="bg-red-500 text-white text-[8px] px-1.5 py-0.5 rounded font-bold">-${y}%</span>
                </div>
            `}const u=r.variations&&r.variations.length>0,g=r.productId,f=isProductInWishlist(g)?'<svg class="w-5 h-5 text-red-500 fill-current" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>':'<svg class="w-5 h-5 text-gray-400 hover:text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>';e.innerHTML+=`
            <div class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition duration-300 relative" data-product-id="${g}">
                <!-- Wishlist Heart Button -->
                <button id="wishlist-btn-${g}" data-action="toggle-wishlist" data-product-id="${g}" class="absolute top-3 right-3 z-20 p-2 bg-white/90 hover:bg-white rounded-full shadow-md transition active:scale-95">
                    ${f}
                </button>
                <div class="absolute top-3 left-3 z-10 flex flex-col gap-2">
                    <div class="bg-amber-400 text-white text-[10px] font-bold px-2 py-1 rounded-lg shadow-sm flex items-center gap-1">
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                        +${m} Poin
                    </div>
                    ${p?`
                    <div class="bg-green-600 text-white text-[10px] font-bold px-2 py-1 rounded-lg shadow-sm flex items-center gap-1">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7c.78.78.78 2.047 0 2.828l-7 7c-.78.78-2.047.78-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path></svg>
                        Harga Grosir Tersedia
                    </div>
                    `:""}
                </div>
                <div class="lazy-image-wrapper">
                    <div class="skeleton skeleton-product-image"></div>
                    <img src="${i}" alt="${escapeHtml(r.nama)}" data-action="show-detail" data-product-id="${g}" class="w-full h-48 object-cover cursor-pointer hover:opacity-90 transition-opacity ${r.stok===0?"grayscale opacity-60":""}" loading="lazy" data-fallback-src="https://placehold.co/300x200?text=Produk" onload="this.classList.add('loaded'); this.previousElementSibling.style.display='none';">
                </div>
                <div class="p-6">
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="text-lg font-bold text-gray-800">${escapeHtml(r.nama)}</h4>
                        ${d}
                    </div>
                    <div class="flex justify-between items-center mb-4">
                        <button data-action="share-product" data-product-id="${g}" class="text-green-600 hover:text-green-700 flex items-center gap-1 text-xs font-medium">
                            <span>Share</span>
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.335-1.662c1.72.937 3.659 1.432 5.631 1.433h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                        </button>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-green-50 p-3 rounded-lg">
                            <p class="text-[10px] text-green-600 font-bold uppercase">Harga Cash</p>
                            <div class="flex flex-col">
                                ${c}
                                <p class="text-lg font-bold text-green-700">Rp ${r.harga.toLocaleString("id-ID")}</p>
                            </div>
                        </div>
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <p class="text-[10px] text-blue-600 font-bold uppercase">Bayar Gajian</p>
                            <div class="flex flex-col">
                                <p class="text-[8px] text-blue-400 mb-0.5">Harga Per Tgl ${new Date().toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"}).replace(/\//g,"-")}</p>
                                <p class="text-lg font-bold text-blue-700">Rp ${r.hargaGajian.toLocaleString("id-ID")}</p>
                            </div>
                        </div>
                    </div>
                    ${h}
                    ${u?`
                    <button data-action="show-detail" data-product-id="${g}" class="w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 rounded-xl transition flex items-center justify-center gap-2 mb-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                        Pilih Variasi
                    </button>
                    `:`
                    <button data-action="add-to-cart" data-product-id="${g}" ${r.stok===0?"disabled":""} class="w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-300 text-white font-bold py-3 rounded-xl transition flex items-center justify-center gap-2 mb-3">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                        Tambah ke Keranjang
                    </button>
                    `}
                    <div class="grid grid-cols-2 gap-2">
                        <button data-action="show-detail" data-product-id="${g}" class="bg-gray-100 hover:bg-gray-200 text-gray-600 font-bold py-2 rounded-lg text-sm transition">Rincian</button>
                        <button data-action="direct-order" data-product-id="${g}" ${r.stok===0?"disabled":""} class="bg-green-100 hover:bg-green-200 text-green-700 font-bold py-2 rounded-lg text-sm transition">Beli Sekarang</button>
                    </div>

                </div>
            </div>
        `})}function filterProducts(){const t=document.getElementById("search-input"),e=t?normalizeSearch(t.value):"",n=document.getElementById("sort-select"),a=n?n.value:"default";filteredProducts=allProducts.filter(o=>{const s=matchesQuery(o,e),r=currentCategory==="Semua"||o.category===currentCategory;return s&&r}),filteredProducts=sortProducts(filteredProducts,a),currentPage=1,renderProducts(filteredProducts),renderPagination(filteredProducts.length),renderSearchSuggestions(e)}function sortProducts(t,e){const n=[...t];return e==="price-asc"?(n.sort((a,o)=>(a.harga||0)-(o.harga||0)),n):e==="price-desc"?(n.sort((a,o)=>(o.harga||0)-(a.harga||0)),n):(e==="promo"&&n.sort((a,o)=>promoScore(o)-promoScore(a)),n)}function promoScore(t){const e=t.harga||0,n=t.hargaCoret||t.harga_coret||0;return!e||!n||n<=e?0:Math.round((n-e)/n*100)}function normalizeSearch(t){return String(t||"").toLowerCase().replace(/[^a-z0-9\\s]/g," ").replace(/\\s+/g," ").trim()}function tokenize(t){return normalizeSearch(t).split(" ").filter(Boolean)}function matchesQuery(t,e){if(!e)return!0;const n=`${normalizeSearch(t.nama)} ${normalizeSearch(t.deskripsi||"")}`.trim(),a=e.replace(/\s+/g,""),o=n.replace(/\s+/g,"");return n.includes(e)||a&&o.includes(a)?!0:tokenize(e).every(s=>n.includes(s))}function renderSearchSuggestions(t){const e=document.getElementById("search-suggestions"),n=document.getElementById("search-suggestions-header"),a=n&&window.innerWidth<768?n:e;if(!a)return;if(!t)return a.classList.add("hidden"),void(a.innerHTML="");const o=getSearchSuggestions(t,6);if(o.length===0)return a.classList.add("hidden"),void(a.innerHTML="");a.innerHTML=o.map(s=>`
        <button type="button" class="w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-green-50 transition" data-action="search-suggestion" data-value="${escapeHtml(s)}">${escapeHtml(s)}</button>
    `).join(""),a.classList.remove("hidden")}function closeSearchSuggestions(){[document.getElementById("search-suggestions"),document.getElementById("search-suggestions-header")].forEach(t=>{t&&(t.classList.add("hidden"),t.innerHTML="")})}function getSearchSuggestions(t,e=6){const n=tokenize(t);if(n.length===0)return[];const a=allProducts.map(s=>{const r=[...tokenize(s.nama),...tokenize(s.deskripsi||"")];let d=0;return n.forEach(l=>{r.forEach(i=>{i===l?d=Math.max(d,3):i.includes(l)?d=Math.max(d,2):l.length>2&&i.length>2&&levenshtein(i,l)<=1&&(d=Math.max(d,1))})}),{name:s.nama,score:d}}).filter(s=>s.score>0),o=new Map;return a.sort((s,r)=>r.score-s.score).forEach(s=>{o.has(s.name)||o.set(s.name,s)}),Array.from(o.values()).slice(0,e).map(s=>s.name)}function levenshtein(t,e){const n=t.length,a=e.length;if(n===0)return a;if(a===0)return n;const o=Array.from({length:n+1},()=>new Array(a+1).fill(0));for(let s=0;s<=n;s+=1)o[s][0]=s;for(let s=0;s<=a;s+=1)o[0][s]=s;for(let s=1;s<=n;s+=1)for(let r=1;r<=a;r+=1){const d=t[s-1]===e[r-1]?0:1;o[s][r]=Math.min(o[s-1][r]+1,o[s][r-1]+1,o[s-1][r-1]+d)}return o[n][a]}function renderPagination(t){const e=document.getElementById("pagination-container");if(!e)return;const n=Math.ceil(t/12);if(n<=1)return void(e.innerHTML="");let a="";a+=`
        <button type="button" data-action="change-page" data-page="${currentPage-1}" ${currentPage===1?"disabled":""} 
            class="w-10 h-10 flex items-center justify-center rounded-lg border-2 border-gray-200 text-gray-600 hover:border-green-500 hover:text-green-600 disabled:opacity-30 disabled:cursor-not-allowed transition">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
        </button>
    `;for(let o=1;o<=n;o++)o===1||o===n||o>=currentPage-1&&o<=currentPage+1?a+=`
                <button type="button" data-action="change-page" data-page="${o}" 
                    class="w-10 h-10 flex items-center justify-center rounded-lg border-2 font-bold transition ${o===currentPage?"bg-green-600 border-green-600 text-white":"border-gray-200 text-gray-600 hover:border-green-500 hover:text-green-600"}">
                    ${o}
                </button>
            `:o!==currentPage-2&&o!==currentPage+2||(a+='<span class="text-gray-400">...</span>');a+=`
        <button type="button" data-action="change-page" data-page="${currentPage+1}" ${currentPage===n?"disabled":""} 
            class="w-10 h-10 flex items-center justify-center rounded-lg border-2 border-gray-200 text-gray-600 hover:border-green-500 hover:text-green-600 disabled:opacity-30 disabled:cursor-not-allowed transition">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
        </button>
    `,e.innerHTML=a}function changePage(t){const e=Math.ceil(filteredProducts.length/12);t<1||t>e||(currentPage=t,renderProducts(filteredProducts),renderPagination(filteredProducts.length),document.getElementById("katalog").scrollIntoView({behavior:"smooth"}))}function setCategory(t){currentCategory=t,document.querySelectorAll(".filter-btn").forEach(e=>{e.innerText===t?(e.classList.add("active"),e.classList.remove("border-gray-300","bg-white","text-gray-700"),e.classList.add("border-green-500","bg-green-50","text-green-700"),e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})):(e.classList.remove("active"),e.classList.remove("border-green-500","bg-green-50","text-green-700"),e.classList.add("border-gray-300","bg-white","text-gray-700"))}),filterProducts()}function addToCart(t,e,n=1){storeClosed?showStoreWarning(()=>{proceedAddToCart(t,e,n)}):proceedAddToCart(t,e,n)}function proceedAddToCart(t,e,n=1){if(t.variations&&t.variations.length>0&&!selectedVariation)return void showDetail(t);const a={...t};if(selectedVariation){a.selectedVariation=selectedVariation,a.harga=selectedVariation.harga,a.sku=selectedVariation.sku,a.stok=selectedVariation.stok;const s=typeof calculateGajianPrice=="function"?calculateGajianPrice(selectedVariation.harga):{price:selectedVariation.harga,daysLeft:0,markupPercent:0};a.hargaGajian=s.price}const o=cart.find(s=>{const r=s.id===a.id,d=!s.selectedVariation&&!a.selectedVariation||s.selectedVariation&&a.selectedVariation&&s.selectedVariation.sku===a.selectedVariation.sku;return r&&d});if(o?o.qty+=n:cart.push({...a,qty:n}),saveCart(),updateCartUI(),selectedVariation=null,e&&e.currentTarget){const s=(e.currentTarget.closest(".bg-white")||document.getElementById("detail-modal")).querySelector("img"),r=document.querySelector("header button");if(s&&r){const d=s.getBoundingClientRect(),l=r.getBoundingClientRect(),i=document.createElement("img");i.src=s.src,i.className="fly-item",i.style.top=`${d.top}px`,i.style.left=`${d.left}px`,i.style.width=`${d.width}px`,i.style.height=`${d.height}px`,i.style.borderRadius="12px",document.body.appendChild(i),requestAnimationFrame(()=>{i.style.top=`${l.top+l.height/2}px`,i.style.left=`${l.left+l.width/2}px`,i.style.width="20px",i.style.height="20px",i.style.opacity="0.5",i.style.borderRadius="50%"}),setTimeout(()=>{i.remove(),r.classList.add("cart-pop"),setTimeout(()=>r.classList.remove("cart-pop"),400)},800)}}else{const s=document.querySelector("header button");s&&(s.classList.add("cart-pop"),setTimeout(()=>s.classList.remove("cart-pop"),400))}showToast(`${a.nama}${a.selectedVariation?" ("+a.selectedVariation.nama+")":""} ditambahkan ke keranjang`)}function showToast(t){let e=document.querySelector(".toast-container");e||(e=document.createElement("div"),e.className="toast-container",e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),document.body.appendChild(e));const n=document.createElement("div");n.className="toast",n.setAttribute("role","status"),n.setAttribute("aria-live","polite"),n.setAttribute("aria-atomic","true"),n.innerHTML=`
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        <span>${escapeHtml(t)}</span>
    `,e.appendChild(n),setTimeout(()=>n.remove(),3e3)}function showSuccessNotification(t,e){const n=document.createElement("div");n.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] animate-fade-in",n.style.animation="fadeIn 0.3s ease-out";const a=document.createElement("div");a.className="bg-white rounded-2xl shadow-2xl p-8 max-w-sm mx-4 text-center transform scale-95 relative",a.style.animation="scaleIn 0.3s ease-out forwards";const o=sanitizeUrl("assets/images/success-shield.gif","assets/images/success-shield.gif");a.innerHTML=`
        <button type="button" data-action="dismiss-notification" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition p-1 rounded-full hover:bg-gray-100">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
        <div class="mb-4">
            <div class="w-32 h-32 flex items-center justify-center mx-auto mb-4">
                <img src="${o}" alt="Success" class="w-full h-full object-contain" data-fallback-src="assets/images/success-shield.gif">
            </div>
            <h3 class="text-2xl font-bold text-gray-800 mb-2">Pesanan Berhasil Dikirim!</h3>
            <p class="text-gray-600 mb-4">Order ID: <span class="font-mono font-semibold text-green-600">${escapeHtml(t)}</span></p>
            <p class="text-sm text-gray-500 mb-6">Pesanan Anda telah tercatat dan akan segera diproses. Silakan lanjutkan ke WhatsApp untuk konfirmasi.</p>
        </div>
        <a href="${e}" target="_blank" class="block w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-xl transition shadow-lg flex items-center justify-center gap-3 mt-4">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.335-1.662c1.72.937 3.659 1.432 5.631 1.433h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
            <span>Lanjut ke WhatsApp</span>
        </a>
    `,n.appendChild(a),document.body.appendChild(n);const s=a.querySelector('[data-action="dismiss-notification"]');if(s&&s.addEventListener("click",()=>n.remove()),!document.getElementById("success-notification-styles")){const r=document.createElement("style");r.id="success-notification-styles",r.textContent=`
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            @keyframes scaleIn {
                from { transform: scale(0.95); opacity: 0; }
                to { transform: scale(1); opacity: 1; }
            }
            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
            @keyframes successCircle {
                0% {
                    transform: scale(0);
                    opacity: 0;
                }
                50% {
                    transform: scale(1.1);
                }
                100% {
                    transform: scale(1);
                    opacity: 1;
                }
            }
            @keyframes successCheck {
                0% {
                    stroke-dashoffset: 50;
                    opacity: 0;
                }
                50% {
                    opacity: 1;
                }
                100% {
                    stroke-dashoffset: 0;
                }
            }
            @keyframes bounce {
                0%, 100% {
                    transform: translateY(0);
                }
                50% {
                    transform: translateY(-10px);
                }
            }
            .animate-success-circle {
                animation: successCircle 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            }
            .animate-success-check {
                animation: successCheck 0.6s ease-in-out 0.3s forwards, bounce 0.6s ease-in-out 0.9s;
            }
            .checkmark-path {
                stroke-dasharray: 50;
                stroke-dashoffset: 50;
            }
        `,document.head.appendChild(r)}n.addEventListener("click",r=>{r.target===n&&(n.style.animation="fadeOut 0.3s ease-out",setTimeout(()=>n.remove(),300))})}function saveCart(){localStorage.setItem("sembako_cart",JSON.stringify(cart))}function updateCartUI(){const t=cart.reduce((s,r)=>s+r.qty,0),e=document.getElementById("cart-count");e&&(t>0?(e.innerText=t,e.classList.remove("hidden")):e.classList.add("hidden"));const n=document.getElementById("cart-items"),a=document.getElementById("cart-footer"),o=document.getElementById("cart-empty");if(n)if(cart.length===0)n.innerHTML="",a&&a.classList.add("hidden"),o&&o.classList.remove("hidden");else{o&&o.classList.add("hidden"),a&&a.classList.remove("hidden");let s=0;n.innerHTML=cart.map((i,m)=>{const h=calculateTieredPrice(i.harga,i.qty,i.grosir),p=h<i.harga,c=h*i.qty;s+=c;let u=(i.gambar?i.gambar.split(","):[])[0]||"https://placehold.co/100x100?text=Produk";return i.selectedVariation&&i.selectedVariation.gambar&&(u=i.selectedVariation.gambar),`
                <div class="flex items-center gap-4 bg-gray-50 p-3 rounded-xl">
                    <img src="${sanitizeUrl(u,"https://placehold.co/100x100?text=Produk")}" class="w-16 h-16 object-cover rounded-lg" data-fallback-src="https://placehold.co/100x100?text=Produk">
                    <div class="flex-1">
                        <h5 class="font-bold text-gray-800 text-sm">${i.nama}${i.selectedVariation?" ("+i.selectedVariation.nama+")":""}</h5>
                        <div class="flex flex-col">
                            ${p?`<span class="text-[10px] text-gray-400 line-through">Rp ${i.harga.toLocaleString("id-ID")}</span>`:""}
                            <p class="text-green-600 font-bold text-xs">Rp ${h.toLocaleString("id-ID")} ${p?'<span class="bg-green-100 text-green-700 text-[8px] px-1 rounded ml-1">Grosir</span>':""}</p>
                        </div>
                        <div class="flex items-center gap-3 mt-2">
                            <button type="button" data-action="update-cart-qty" data-index="${m}" data-delta="-1" class="w-6 h-6 bg-white border border-gray-200 rounded-full flex items-center justify-center text-gray-500">-</button>
                            <span class="text-sm font-bold">${i.qty}</span>
                            <button type="button" data-action="update-cart-qty" data-index="${m}" data-delta="1" class="w-6 h-6 bg-white border border-gray-200 rounded-full flex items-center justify-center text-gray-500">+</button>
                        </div>
                    </div>
                    <button type="button" data-action="remove-cart-item" data-index="${m}" class="text-red-400 hover:text-red-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                    </button>
                </div>
            `}).join("");const r=document.getElementById("cart-total");r&&(r.innerText=`Rp ${s.toLocaleString("id-ID")}`);const d=document.getElementById("order-summary-total");d&&(d.innerText=`Rp ${s.toLocaleString("id-ID")}`);const l=document.getElementById("sticky-order-total");l&&(l.innerText=`Rp ${s.toLocaleString("id-ID")}`)}}function updateQty(t,e){cart[t].qty+=e,cart[t].qty<1&&cart.splice(t,1),saveCart(),updateCartUI()}function removeItem(t){cart.splice(t,1),saveCart(),updateCartUI()}function openCartModal(){const t=document.getElementById("cart-modal");t&&(t.classList.remove("hidden"),document.body.classList.add("modal-active"))}function closeCartModal(){const t=document.getElementById("cart-modal");t&&(t.classList.add("hidden"),document.body.classList.remove("modal-active"))}function updateModalQty(t){const e=document.getElementById("modal-qty");if(!e)return;let n=parseInt(e.value)||1;n+=t,n<1&&(n=1),e.value=n,e.oninput({target:e})}function showDetail(t){closeWishlistModal(),console.log("showDetail called for product:",t.nama);const e=document.getElementById("detail-modal");if(!e)return;currentModalProduct=t,e.dataset.productId=t.productId||"",selectedVariation=null;const n=document.getElementById("modal-qty");n&&(n.value=1);const a=document.getElementById("modal-product-name"),o=document.getElementById("modal-product-image"),s=(document.getElementById("modal-cash-price"),document.getElementById("modal-gajian-price"),document.getElementById("modal-price-date")),r=document.getElementById("modal-items-list"),d=document.getElementById("modal-badges"),l=(document.getElementById("savings-highlight"),document.getElementById("savings-amount"),document.getElementById("modal-variation-container"));a&&(a.innerText=t.nama),n&&(n.oninput=m=>{const h=parseInt(m.target.value)||1,p=selectedVariation?selectedVariation.harga:t.harga,c=selectedVariation?selectedVariation.grosir:t.grosir,u=selectedVariation?selectedVariation.harga_coret||0:t.hargaCoret||0;typeof updateTieredPricingUI=="function"&&updateTieredPricingUI({...t,harga:p,grosir:c},h);const g=typeof calculateTieredPrice=="function"?calculateTieredPrice(p,h,c):p;updateModalPrices(g*h,(typeof calculateGajianPrice=="function"?calculateGajianPrice(g):{price:g}).price*h,u*h)}),l?t.variations&&t.variations.length>0?(l.classList.remove("hidden"),document.getElementById("modal-variation-list").innerHTML=t.variations.map((m,h)=>`
	                <button type="button" data-action="select-variation" data-index="${h}" class="variation-btn border-2 border-gray-200 rounded-xl p-3 text-left transition hover:border-green-500 focus:outline-none">
                    <p class="text-xs font-bold text-gray-800">${escapeHtml(m.nama)}</p>
                    <p class="text-[10px] text-green-600 font-bold">Rp ${m.harga.toLocaleString("id-ID")}</p>
                    ${m.stok<=0?'<p class="text-[8px] text-red-500 font-bold">Stok Habis</p>':""}
                </button>
            `).join(""),selectVariation(t.variations[0],0)):(l.classList.add("hidden"),updateModalPrices(t.harga,t.hargaGajian,t.hargaCoret)):updateModalPrices(t.harga,t.hargaGajian,t.hargaCoret),s&&(s.innerText=`Harga Per Tgl ${new Date().toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"}).replace(/\//g,"-")}`),d&&(d.innerHTML=`
            <span class="bg-green-100 text-green-700 text-[10px] px-2.5 py-1 rounded-lg font-bold">${escapeHtml(t.category)}</span>
            ${t.stok>0?`<span class="bg-blue-100 text-blue-700 text-[10px] px-2.5 py-1 rounded-lg font-bold">Stok: ${t.stok}</span>`:'<span class="bg-red-100 text-red-700 text-[10px] px-2.5 py-1 rounded-lg font-bold">Stok Habis</span>'}
        `);const i=t.gambar?t.gambar.split(","):[];if(typeof initializeSlider=="function"?initializeSlider(i):o&&(o.src=i.length>0?i[0]:"https://placehold.co/300x200?text=Produk",o.onerror=function(){this.src="https://placehold.co/300x200?text=Produk"}),r){const m=t.deskripsi.split(`
`).filter(p=>p.trim()!==""),h=["\u{1F35C}","\u{1F372}","\u{1F4E6}","\u2615","\u{1F35A}","\u{1F373}","\u{1F9C2}"];r.innerHTML=m.map((p,c)=>`
            <div class="flex items-center gap-4 bg-gray-50/50 p-3 rounded-xl border border-gray-100/50">
                <span class="text-xl">${h[c%h.length]}</span>
                <span class="text-sm font-medium text-gray-700">${escapeHtml(p.trim())}</span>
            </div>
        `).join("")}typeof updateTieredPricingUI=="function"&&updateTieredPricingUI(t,1),e.classList.remove("hidden"),document.body.classList.add("modal-active")}function selectVariation(t,e){if(selectedVariation=t,document.querySelectorAll(".variation-btn").forEach((a,o)=>{o===e?(a.classList.add("border-green-500","bg-green-50"),a.classList.remove("border-gray-200")):(a.classList.remove("border-green-500","bg-green-50"),a.classList.add("border-gray-200"))}),t.gambar&&typeof initializeSlider=="function"){const a=t.gambar.split(",");initializeSlider(a)}const n=document.getElementById("modal-qty");if(n)n.oninput({target:n});else{const a=typeof calculateGajianPrice=="function"?calculateGajianPrice(t.harga):{price:t.harga,daysLeft:0,markupPercent:0};updateModalPrices(t.harga,a.price,t.harga_coret||0)}}function updateModalPrices(t,e,n){const a=document.getElementById("modal-cash-price"),o=document.getElementById("modal-gajian-price"),s=document.getElementById("savings-highlight"),r=document.getElementById("savings-amount");a&&(a.innerText=`Rp ${t.toLocaleString("id-ID")}`),o&&(o.innerText=`Rp ${e.toLocaleString("id-ID")}`),n>t?(s&&s.classList.remove("hidden"),r&&(r.innerText=`Rp ${(n-t).toLocaleString("id-ID")}`)):s&&s.classList.add("hidden")}function closeDetailModal(){const t=document.getElementById("detail-modal");t&&(t.classList.add("hidden"),document.body.classList.remove("modal-active")),selectedVariation=null}function directOrder(t){storeClosed?showStoreWarning(()=>{proceedDirectOrder(t)}):proceedDirectOrder(t)}function proceedDirectOrder(t){if(t.variations&&t.variations.length>0&&!selectedVariation)return void showDetail(t);const e={...t};if(selectedVariation){e.selectedVariation=selectedVariation,e.harga=selectedVariation.harga,e.sku=selectedVariation.sku,e.stok=selectedVariation.stok;const o=typeof calculateGajianPrice=="function"?calculateGajianPrice(selectedVariation.harga):{price:selectedVariation.harga,daysLeft:0,markupPercent:0};e.hargaGajian=o.price}const n=document.getElementById("modal-qty"),a=n&&parseInt(n.value)||1;cart=[{...e,qty:a}],saveCart(),updateCartUI(),openOrderModal(),selectedVariation=null}function directOrderFromModal(){const t=document.getElementById("detail-modal"),e=findProductById(t?t.dataset.productId:null);e&&(directOrder(e),closeDetailModal())}function checkStoreStatus(){storeClosed=CONFIG.isStoreClosed();const t=document.getElementById("store-closed-banner"),e=document.getElementById("main-header");storeClosed?(t&&t.classList.remove("hidden"),e&&(e.style.top="36px"),sessionStorage.getItem("store_closed_modal_shown")||setTimeout(()=>{document.getElementById("store-closed-modal").classList.remove("hidden"),sessionStorage.setItem("store_closed_modal_shown","true")},1e3)):(t&&t.classList.add("hidden"),e&&(e.style.top="0"))}function closeStoreClosedModal(){document.getElementById("store-closed-modal").classList.add("hidden")}function showStoreWarning(t){const e=document.getElementById("store-warning-modal"),n=document.getElementById("confirm-store-warning");e.classList.remove("hidden"),n.onclick=()=>{e.classList.add("hidden"),t&&t()}}function closeStoreWarningModal(){document.getElementById("store-warning-modal").classList.add("hidden")}function openOrderModal(){if(cart.length===0)return;closeCartModal(),prefillCustomerInfo();const t=document.getElementById("order-summary"),e=document.querySelector('input[name="pay-method"]:checked'),n=e&&e.value==="Bayar Gajian";if(t){let o=0;t.innerHTML=cart.map(s=>{const r=n?s.hargaGajian:s.harga,d=calculateTieredPrice(r,s.qty,s.grosir),l=d<r,i=calculateRewardPoints(s.harga,s.nama)*s.qty;return o+=i,`
                <div class="flex justify-between items-center py-1">
                    <div class="flex flex-col">
                        <span class="font-medium">${escapeHtml(s.nama)}${s.selectedVariation?" ("+escapeHtml(s.selectedVariation.nama)+")":""} (x${s.qty})</span>
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] text-amber-600 font-bold flex items-center gap-1">
                                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                +${i.toFixed(1)} Poin
                            </span>
                            ${l?'<span class="bg-green-100 text-green-700 text-[8px] px-1 rounded font-bold">Harga Grosir</span>':""}
                        </div>
                    </div>
                    <div class="flex flex-col items-end">
                        ${l?`<span class="text-[10px] text-gray-400 line-through">Rp ${(r*s.qty).toLocaleString("id-ID")}</span>`:""}
                        <span class="font-bold">Rp ${(d*s.qty).toLocaleString("id-ID")}</span>
                    </div>
                </div>
            `}).join(""),t.innerHTML+=`
            <div class="border-t border-dashed border-gray-200 mt-2 pt-2 flex justify-between items-center">
                <span class="text-xs font-bold text-amber-700">Total Poin Didapat:</span>
                <span class="text-sm font-black text-amber-700 flex items-center gap-1">
                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                    ${escapeHtml(o.toFixed(1))} Poin
                </span>
            </div>
        `}updateOrderTotal(),updateOrderCTAState();const a=document.getElementById("order-modal");a&&(a.classList.remove("hidden"),document.body.classList.add("modal-active"))}function prefillCustomerInfo(){const t=document.getElementById("customer-name"),e=document.getElementById("customer-phone");if(!t||!e)return;const n=localStorage.getItem("gosembako_user");if(!n)return;let a;try{a=JSON.parse(n)}catch{return}const o=(a.nama||"").trim(),s=normalizePhoneNumber(a.whatsapp||a.phone||"");!t.value.trim()&&o&&(t.value=o),!e.value.trim()&&s&&(e.value=s)}function closeOrderModal(){const t=document.getElementById("order-modal");t&&(t.classList.add("hidden"),document.body.classList.remove("modal-active"))}function shareProduct(t){const e=`Cek paket sembako murah "${t}" di GoSembako! Kualitas terjamin, harga bersahabat.`,n=window.location.href,a=`https://wa.me/?text=${encodeURIComponent(e+" "+n)}`;window.open(a,"_blank")}function startNotificationLoop(){const t=["Siti","Budi","Ani","Joko","Rina","Agus","Dewi","Eko"],e=allProducts.length>0?allProducts.map(n=>n.nama):["Paket Sembako"];setInterval(()=>{Math.random()>.7&&showNotification(`${t[Math.floor(Math.random()*t.length)]} baru saja membeli ${e[Math.floor(Math.random()*e.length)]}`)},15e3)}function showNotification(t){const e=document.createElement("div");e.className="fixed bottom-24 left-4 bg-white/90 backdrop-blur shadow-lg rounded-xl p-3 flex items-center gap-3 border border-green-100 z-50 animate-bounce",e.setAttribute("role","status"),e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.innerHTML=`
            <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center text-green-600">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a8 8 0 100 16 8 8 0 000-16zm1 11H9v-2h2v2zm0-4H9V5h2v4z"></path></svg>
            </div>
        <p class="text-xs font-medium text-gray-700">${escapeHtml(t)}</p>
    `,document.body.appendChild(e),setTimeout(()=>e.remove(),5e3)}function toggleLocationField(){const t=document.querySelector('input[name="ship-method"]:checked'),e=document.getElementById("location-field"),n=document.getElementById("delivery-location-ui"),a=document.getElementById("pickup-location-ui");t&&(t.value==="Antar Nikomas"?(e.classList.add("hidden"),n.classList.add("hidden"),a.classList.add("hidden")):t.value==="Antar Kerumah"?(e.classList.remove("hidden"),n.classList.remove("hidden"),a.classList.add("hidden")):t.value==="Ambil Ditempat"&&(e.classList.remove("hidden"),n.classList.add("hidden"),a.classList.remove("hidden"))),updateOrderTotal()}function getCurrentLocation(){const t=document.getElementById("get-location-btn"),e=document.getElementById("location-link");navigator.geolocation?(t.disabled=!0,t.innerHTML="<span>\u231B Mengambil Lokasi...</span>",navigator.geolocation.getCurrentPosition(n=>{const a=`https://www.google.com/maps?q=${n.coords.latitude},${n.coords.longitude}`;e.value=a,t.classList.remove("bg-white","text-blue-700","border-blue-200"),t.classList.add("bg-green-600","text-white","border-green-600"),t.innerHTML="<span>\u2705 Lokasi Berhasil Dibagikan</span>",alert("Lokasi berhasil diambil!")},n=>{t.disabled=!1,t.innerHTML="<span>\u{1F4CD} Bagikan Lokasi Saya</span>";let a="Gagal mengambil lokasi.";n.code===1&&(a="Mohon izinkan akses lokasi untuk fitur ini."),alert(a)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})):alert("Geolocation tidak didukung oleh browser Anda")}function updateOrderTotal(){const t=document.querySelector('input[name="pay-method"]:checked'),e=document.querySelector('input[name="ship-method"]:checked'),n=t&&t.value==="Bayar Gajian",a=e&&e.value==="Antar Nikomas";let o=0;cart.forEach(h=>{const p=n?h.hargaGajian:h.harga,c=calculateTieredPrice(p,h.qty,h.grosir);o+=c*h.qty});const s=a?2e3:0,r=o+s,d=document.getElementById("sticky-order-total"),l=document.getElementById("order-summary-total");d&&(d.innerText=`Rp ${r.toLocaleString("id-ID")}`),l&&(l.innerText=`Rp ${r.toLocaleString("id-ID")}`);const i=document.getElementById("order-subtotal"),m=document.getElementById("order-shipping");i&&(i.innerText=`Rp ${o.toLocaleString("id-ID")}`),m&&(m.innerText=`Rp ${s.toLocaleString("id-ID")}`),updateOrderCTAState()}function isOrderFormValid(){const t=document.getElementById("customer-name"),e=document.getElementById("customer-phone"),n=document.querySelector('input[name="pay-method"]:checked'),a=document.querySelector('input[name="ship-method"]:checked');if(!t||!e)return!1;const o=t.value.trim(),s=o.replace(/\s/g,"");if(!o||s.length<4)return!1;const r=e.value.trim();return r?!(normalizePhone(r).replace(/[^0-9]/g,"").length<10)&&!!(n&&a):!1}function updateOrderCTAState(){const t=document.getElementById("send-order-btn")||document.querySelector('[data-action="send-wa"]');if(!t)return;const e=isOrderFormValid();t.disabled=!e,t.setAttribute("aria-disabled",String(!e))}function normalizePhone(t){if(!t)return"";let e=t.toString().replace(/[^0-9]/g,"");return e.startsWith("62")?e="0"+e.slice(2):e.startsWith("8")?e="0"+e:e.startsWith("0")||(e="0"+e),e.startsWith("0")&&!e.startsWith("08")&&e.length,e}function generateOrderId(){const t="0123456789";let e="";for(let n=0;n<6;n++)e+=t.charAt(Math.floor(10*Math.random()));return`ORD-${e}`}async function logOrderToGAS(t){const e={id:t.id||generateOrderId(),pelanggan:t.pelanggan||"",produk:t.produk||"",qty:t.qty||0,total:t.total||0,status:t.status||"Pending",tanggal:t.tanggal||new Date().toLocaleString("id-ID"),phone:t.phone||"",poin:t.poin||0,point_processed:t.point_processed||"No"};console.log("\u{1F4DD} Logging order to GAS:",e);try{const n=await GASActions.create("orders",e);return console.log("\u2705 Order logged successfully:",n),n}catch(n){throw console.error("\u274C Error logging order to GAS:",n),n}}async function sendToWA(){const t=event?.target||document.querySelector('[data-action="send-wa"]');if(t&&t.disabled)return;const e=document.getElementById("customer-name").value,n=document.getElementById("customer-phone").value,a=document.querySelector('input[name="pay-method"]:checked')?.value,o=document.querySelector('input[name="ship-method"]:checked')?.value;if(!e||e.trim().length===0)return void alert("Masukkan Nama Lengkap");const s=e.replace(/\s/g,"");if(s.length<4)return void alert("Masukkan Nama Lengkap");const r=s.toLowerCase(),d=[/^(.)\1{3,}$/,/^(.{2})\1{2,}$/,/^(.{3})\1{2,}$/,/^([a-z])([a-z])\1\2{2,}$/];for(const v of d)if(v.test(r))return void alert("Masukkan Nama Lengkap");if(!n||n.trim().length===0)return void alert("Nomor WhatsApp tidak valid");const l=n.replace(/[^0-9]/g,"");if(l.length<10)return void alert("Nomor WhatsApp tidak valid");const i=[/^(\d)\1{9,}$/,/^08(\d)\1{8,}$/,/^(\d{2})\1{4,}$/,/^(\d{3})\1{3,}$/];for(const v of i)if(v.test(l))return void alert("Nomor WhatsApp tidak valid");if(!a)return void alert("Pilih metode pembayaran terlebih dahulu");if(!o)return void alert("Pilih metode pengiriman terlebih dahulu");t&&(t.disabled=!0,t.innerHTML=`
            <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span>Memproses Pesanan...</span>
        `,t.classList.add("opacity-75","cursor-not-allowed"));let m="";m=o==="Antar Nikomas"?"Antar Nikomas (Area PT Nikomas Gemilang)":o==="Antar Kerumah"?"Antar Kerumah (Area Serang & sekitarnya)":"Ambil Ditempat (Kp. Baru, Kec. Kibin)";const h=a==="Bayar Gajian";let p=0,c=0,u="",g="";cart.forEach((v,B)=>{const I=h?v.hargaGajian:v.harga,k=calculateTieredPrice(I,v.qty,v.grosir),T=k<I,L=k*v.qty;p+=L,c+=v.qty;const E=v.selectedVariation?` (${v.selectedVariation.nama})`:"",M=T?` (Harga Grosir: Rp ${k.toLocaleString("id-ID")}/unit)`:"";u+=`${B+1}. ${v.nama}${E} x${v.qty}${M} = Rp ${L.toLocaleString("id-ID")}
`,g+=`${v.nama}${E} (x${v.qty}) | `});const f=o==="Antar Nikomas"?2e3:0;p+=f;const y=CONFIG.getRewardConfig().pointValue||1e4,x=Math.floor(p/y),b=generateOrderId(),w=document.getElementById("location-link")?.value||"",S=`*PESANAN BARU - GOSEMBAKO*

*Order ID: ${b}*
*Data Pelanggan:*
Nama: ${e}
WhatsApp: ${n}

*Detail Pesanan:*
${u}
*Metode Pembayaran:* ${a}
*Metode Pengiriman:* ${o}
*Lokasi/Titik:* ${m}${w?`
*Lokasi Maps:* ${w}`:""}

*Ongkir:* Rp ${f.toLocaleString("id-ID")}
*TOTAL BAYAR: Rp ${p.toLocaleString("id-ID")}*
*Estimasi Poin:* +${x} Poin

Mohon segera diproses ya, terima kasih!`,$=`https://wa.me/628993370200?text=${encodeURIComponent(S)}`,A={id:b,pelanggan:e,produk:g.slice(0,-3),qty:c,total:p,status:"Pending",tanggal:new Date().toLocaleString("id-ID"),phone:normalizePhone(n),poin:x,point_processed:"No"};try{await logOrderToGAS(A),console.log("\u2705 Order logged to spreadsheet successfully"),cart=[],saveCart(),updateCartUI(),closeOrderModal(),showSuccessNotification(b,$)}catch(v){console.error("\u274C Error logging order:",v),alert("Gagal menyimpan pesanan. Silakan coba lagi atau hubungi admin.")}finally{t&&setTimeout(()=>{t.disabled=!1,t.innerHTML=`
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.335-1.662c1.72.937 3.659 1.432 5.631 1.433h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                    Kirim Pesanan ke WhatsApp
                `,t.classList.remove("opacity-75","cursor-not-allowed")},500)}}function handleLogoClick(){let t=parseInt(sessionStorage.getItem("logo_clicks")||0)+1;sessionStorage.setItem("logo_clicks",t),t>=5&&(sessionStorage.setItem("logo_clicks",0),window.location.href="admin/login.html"),setTimeout(()=>sessionStorage.setItem("logo_clicks",0),3e3)}function hideGlobalRewardLoader(){const t=document.getElementById("reward-items-loading"),e=document.getElementById("rewards-loading");t&&t.classList.add("hidden"),e&&e.classList.add("hidden")}async function fetchTukarPoin(){const t=document.getElementById("reward-items-list");if(t)try{renderRewardItems(await ApiService.get("?sheet=tukar_poin",{cacheDuration:18e4}))}catch(e){console.error("Error fetching reward items:",e),t.innerHTML=`
            <div class="text-center py-6 bg-red-50 rounded-2xl border-2 border-dashed border-red-200">
                <p class="text-xs text-red-600 font-semibold">Gagal memuat hadiah. Silakan coba lagi nanti.</p>
            </div>
        `}finally{hideGlobalRewardLoader()}}function renderRewardItems(t){const e=document.getElementById("reward-items-list");e&&(t&&t.length!==0?e.innerHTML=t.map(n=>{const a=n.id||"",o=n.nama||n.judul||"Hadiah",s=n.poin||0,r=n.gambar||"https://via.placeholder.com/100?text=Reward",d=sanitizeUrl(r,"https://via.placeholder.com/100?text=Reward"),l=n.deskripsi||"",i=escapeHtml(o);return`
            <div class="bg-white p-4 rounded-2xl border-2 border-gray-100 hover:border-green-500 transition-all group shadow-sm">
                <div class="flex gap-4">
                    <div class="w-20 h-20 bg-gray-100 rounded-xl overflow-hidden flex-shrink-0">
                        <img src="${d}" alt="${i}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" data-fallback-src="https://via.placeholder.com/100?text=Reward">
                    </div>
                    <div class="flex-1 min-w-0">
                        <h5 class="font-bold text-gray-800 truncate">${i}</h5>
                        <p class="text-[10px] text-gray-500 line-clamp-2 mb-2">${escapeHtml(l)}</p>
                        <div class="flex items-center justify-between">
                            <div class="bg-amber-100 text-amber-700 px-2 py-1 rounded-lg text-[10px] font-bold flex items-center gap-1">
                                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                ${s} Poin
                            </div>
                            <button type="button" data-action="show-confirm-tukar" data-reward-id="${escapeHtml(a)}" class="bg-green-600 hover:bg-green-700 text-white text-[10px] font-bold px-3 py-1.5 rounded-lg transition active:scale-95">
                                Tukar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `}).join(""):e.innerHTML=`
            <div class="text-center py-10 bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl border-2 border-dashed border-gray-300">
                <p class="text-sm text-gray-600 font-semibold">Belum ada hadiah yang tersedia.</p>
            </div>
        `)}function openRewardModal(){const t=document.getElementById("reward-modal");t&&(t.classList.remove("hidden"),document.body.classList.add("modal-active"),fetchTukarPoin())}function closeRewardModal(){const t=document.getElementById("reward-modal");t&&(t.classList.add("hidden"),document.body.classList.remove("modal-active"))}function checkUserPoints(){const t=document.getElementById("reward-phone"),e=t?t.value.trim():"";if(!e)return void alert("Mohon masukkan nomor WhatsApp.");const n=normalizePhone(e),a=event.target,o=a?a.innerText:"Cek Poin";a&&a.tagName==="BUTTON"&&(a.innerText="Mencari...",a.disabled=!0),ApiService.get("?sheet=user_points",{cache:!1}).then(s=>{const r=s.find(i=>normalizePhone(i.phone||i.whatsapp||"")===n),d=document.getElementById("points-display"),l=document.querySelector("#points-display h4");if(r){const i=(r.points||r.poin||"0").toString().replace(",","."),m=parseFloat(i)||0;l.innerHTML=`${escapeHtml(m.toFixed(1))} <span class="text-sm font-bold">Poin</span>`,sessionStorage.setItem("user_points",m),sessionStorage.setItem("reward_phone",n),sessionStorage.setItem("reward_customer_name",r.nama||r.pelanggan||n),showToast(`Ditemukan ${m.toFixed(1)} poin untuk nomor ini!`)}else l.innerHTML=`${escapeHtml("0.0")} <span class="text-sm font-bold">Poin</span>`,sessionStorage.setItem("user_points",0),sessionStorage.setItem("reward_phone",n),sessionStorage.setItem("reward_customer_name",n),showToast("Nomor tidak ditemukan atau belum memiliki poin.");d.classList.remove("hidden")}).catch(s=>{console.error("Error checking points:",s),alert("Gagal mengecek poin. Silakan coba lagi.")}).finally(()=>{a&&a.tagName==="BUTTON"&&(a.innerText=o,a.disabled=!1)})}async function claimReward(t){const e=sessionStorage.getItem("reward_phone"),n=parseFloat(sessionStorage.getItem("user_points"))||0;if(e)try{const a=await ApiService.get(`?sheet=tukar_poin&action=search&id=${t}`,{cache:!1});if(!a||a.length===0)return void alert("Data hadiah tidak ditemukan.");const o=a[0],s=parseFloat(o.poin)||0,r=o.nama||o.judul||"Hadiah";if(n<s)return void alert(`Poin Anda tidak cukup. Dibutuhkan ${s} poin, saldo Anda ${n.toFixed(1)} poin.`);const d=`Tukar ${s} poin Anda dengan "${r}"?
Saldo poin saat ini: ${n.toFixed(1)}`;if(!confirm(d))return;let l=prompt("Silakan masukkan nama Anda untuk klaim ini:",sessionStorage.getItem("reward_customer_name")||"");if(l===null)return;l=l.trim()||"Pelanggan",showToast("Sedang memproses penukaran...");const i=await fetch(`${API_URL}?sheet=user_points`),m=(await i.json()).find(f=>f.phone===e);if(!m||!m.id)return void alert("Data pengguna tidak ditemukan.");const h=n-s;await GASActions.update("user_points",m.id,{points:h,last_updated:new Date().toLocaleString("id-ID")});const p="CLM-"+Date.now().toString().slice(-6);await ApiService.post("?sheet=claims",{data:[{id:p,phone:e,nama:l,hadiah:r,poin:s,status:"Menunggu",tanggal:new Date().toLocaleString("id-ID")}]}),sessionStorage.setItem("user_points",h);const c=document.querySelector("#points-display h4");c&&(c.innerHTML=`${escapeHtml(h.toFixed(1))} <span class="text-sm font-bold">Poin</span>`);const u=`*KLAIM REWARD POIN BERHASIL*

ID Klaim: ${p}
Pelanggan: ${l}
Nomor WhatsApp: ${e}
Reward: ${r}
Poin Ditukar: ${s}
Sisa Poin: ${h.toFixed(1)}

Mohon segera diproses. Terima kasih!`,g=`https://wa.me/628993370200?text=${encodeURIComponent(u)}`;showToast("Penukaran poin berhasil!"),setTimeout(()=>{window.open(g,"_blank")},1500)}catch(a){console.error("Error in claimReward:",a),alert("Terjadi kesalahan saat memproses penukaran: "+a.message)}else alert("Mohon cek poin Anda terlebih dahulu.")}document.addEventListener("DOMContentLoaded",()=>{fetchProducts(),fetchTukarPoin();const t=document.getElementById("product-grid");t&&t.addEventListener("click",c=>{const u=c.target.closest("[data-action]");if(!u||u.disabled)return;const g=u.getAttribute("data-action"),f=u.getAttribute("data-product-id")||u.closest("[data-product-id]")?.getAttribute("data-product-id"),y=findProductById(f);switch(g){case"toggle-wishlist":f&&toggleWishlist(f);break;case"show-detail":y&&showDetail(y);break;case"add-to-cart":y&&addToCart(y,c);break;case"direct-order":y&&directOrder(y);break;case"share-product":y&&shareProduct(y.nama)}});const e=document.getElementById("category-filters");e&&e.addEventListener("click",c=>{const u=c.target.closest('[data-action="set-category"]');if(!u)return;const g=u.getAttribute("data-category");g&&setCategory(g)});const n=document.getElementById("pagination-container");n&&n.addEventListener("click",c=>{const u=c.target.closest('[data-action="change-page"]');if(!u||u.disabled)return;const g=parseInt(u.getAttribute("data-page"),10);Number.isNaN(g)||changePage(g)});const a=document.getElementById("modal-add-cart");a&&a.addEventListener("click",c=>{const u=document.getElementById("detail-modal"),g=findProductById(u?u.dataset.productId:null);if(g){const f=document.getElementById("modal-qty");addToCart(g,c,f?parseInt(f.value):1),closeDetailModal()}});const o=document.getElementById("order-modal");o&&(o.querySelectorAll('input[name="ship-method"], input[name="pay-method"], #customer-name, #customer-phone').forEach(c=>{const u=c.type==="radio"?"change":"input";c.addEventListener(u,updateOrderCTAState)}),updateOrderCTAState());const s=document.getElementById("detail-modal");s&&s.addEventListener("click",c=>{const u=c.target.closest('[data-action="select-variation"]');if(!u||u.disabled)return;const g=parseInt(u.getAttribute("data-index"),10);if(!currentModalProduct||!currentModalProduct.variations||Number.isNaN(g))return;const f=currentModalProduct.variations[g];f&&selectVariation(f,g)});const r=document.getElementById("wishlist-items-container");r&&r.addEventListener("click",c=>{const u=c.target.closest("[data-action]");if(!u||u.disabled)return;const g=u.getAttribute("data-action"),f=u.getAttribute("data-product-id"),y=findProductById(f);g==="wishlist-toggle"&&f?toggleWishlist(f):g==="wishlist-buy"&&y&&showDetail(y)});const d=document.getElementById("cart-items");d&&d.addEventListener("click",c=>{const u=c.target.closest("[data-action]");if(!u||u.disabled)return;const g=u.getAttribute("data-action"),f=parseInt(u.getAttribute("data-index"),10),y=parseInt(u.getAttribute("data-delta"),10);g!=="update-cart-qty"||Number.isNaN(f)||Number.isNaN(y)||updateQty(f,y),g!=="remove-cart-item"||Number.isNaN(f)||removeItem(f)});const l=document.getElementById("search-suggestions");l&&l.addEventListener("click",c=>{const u=c.target.closest('[data-action="search-suggestion"]');if(!u)return;const g=u.getAttribute("data-value")||"",f=document.getElementById("search-input");f&&(f.value=g,filterProducts()),closeSearchSuggestions()});const i=document.getElementById("search-suggestions-header");i&&i.addEventListener("click",c=>{const u=c.target.closest('[data-action="search-suggestion"]');if(!u)return;const g=u.getAttribute("data-value")||"",f=document.getElementById("search-input-header"),y=document.getElementById("search-input");f&&(f.value=g),y&&(y.value=g),filterProducts(),closeSearchSuggestions()});const m=document.getElementById("search-input");m&&m.addEventListener("keydown",c=>{c.key==="Escape"&&closeSearchSuggestions()});const h=document.getElementById("search-input-header");h&&h.addEventListener("keydown",c=>{c.key==="Escape"&&closeSearchSuggestions()}),document.addEventListener("click",c=>{c.target.closest("#search-input")||c.target.closest("#search-suggestions")||c.target.closest("#search-input-header")||c.target.closest("#search-suggestions-header")||closeSearchSuggestions()});const p=document.getElementById("search-input-header");p&&(p.addEventListener("input",c=>{const u=c.target.value||"",g=document.getElementById("search-input");g&&(g.value=u),filterProducts()}),p.addEventListener("focus",()=>{const c=document.getElementById("main-header");c&&c.classList.add("header-search-active")}),p.addEventListener("blur",()=>{const c=document.getElementById("main-header");c&&setTimeout(()=>c.classList.remove("header-search-active"),120)}))});let pendingRewardData={id:null,nama:null,poin:null,gambar:null,deskripsi:null};async function showConfirmTukarModal(t){const e=parseFloat(sessionStorage.getItem("user_points"))||0;if(sessionStorage.getItem("reward_phone"))try{const n=await ApiService.get(`?sheet=tukar_poin&action=search&id=${t}`,{cache:!1});if(!n||n.length===0)return void showToast("Data hadiah tidak ditemukan.");const a=n[0],o=parseFloat(a.poin)||0,s=a.nama||a.judul||"Hadiah";if(e<o)return void showToast(`Poin Anda tidak cukup. Dibutuhkan ${o} poin, saldo Anda ${e.toFixed(1)} poin.`);pendingRewardData={id:t,nama:s,poin:o,gambar:a.gambar||"",deskripsi:a.deskripsi||""},document.getElementById("confirm-reward-name").textContent=s,document.getElementById("confirm-reward-points").textContent=o,document.getElementById("confirm-remaining-points").textContent=(e-o).toFixed(1),document.getElementById("confirm-tukar-modal").classList.remove("hidden"),document.body.classList.add("modal-active")}catch(n){console.error("Error showing confirm modal:",n),showToast("Terjadi kesalahan saat memproses permintaan Anda.")}else showToast("Mohon cek poin Anda terlebih dahulu.")}function cancelTukarModal(){document.getElementById("confirm-tukar-modal").classList.add("hidden"),document.body.classList.remove("modal-active"),pendingRewardData={id:null,nama:null,poin:null,gambar:null,deskripsi:null}}function proceedToNameInput(){document.getElementById("confirm-tukar-modal").classList.add("hidden"),document.getElementById("name-input-modal").classList.remove("hidden"),setTimeout(()=>{document.getElementById("claim-name-input").focus()},100)}function backToConfirmModal(){document.getElementById("name-input-modal").classList.add("hidden"),document.getElementById("confirm-tukar-modal").classList.remove("hidden"),document.getElementById("claim-name-input").value=""}async function submitNameAndClaim(){const t=document.getElementById("claim-name-input").value.trim();t?t.length<3?showToast("Nama harus minimal 3 karakter."):(document.getElementById("name-input-modal").classList.add("hidden"),document.body.classList.remove("modal-active"),await processClaimReward(pendingRewardData.id,t)):showToast("Mohon masukkan nama Anda terlebih dahulu.")}async function processClaimReward(t,e){const n=sessionStorage.getItem("reward_phone"),a=parseFloat(sessionStorage.getItem("user_points"))||0;try{const o=await ApiService.get(`?sheet=tukar_poin&action=search&id=${t}`,{cache:!1});if(!o||o.length===0)return void showToast("Data hadiah tidak ditemukan.");const s=o[0],r=parseFloat(s.poin)||0,d=s.nama||s.judul||"Hadiah";if(a<r)return void showToast("Poin Anda tidak cukup.");showToast("Sedang memproses penukaran...");const l=await fetch(`${API_URL}?sheet=user_points`),i=await l.json(),m=normalizePhone(n),h=[m,m.replace(/^0/,"62"),m.replace(/^0/,"+62"),m.replace(/^0/,"")];let p=null;for(const b of h)if(p=i.find(w=>normalizePhone(w.phone||w.whatsapp||"")===m),p){console.log(`\u2705 Found user data with phone variant: ${b}`);break}if(!p)return console.error("\u274C User not found. Phone:",n,"Normalized:",m),console.error("Available users:",i.map(b=>({phone:b.phone,normalized:normalizePhone(b.phone||b.whatsapp||"")}))),void alert("Data pengguna tidak ditemukan. Pastikan nomor WhatsApp Anda sudah terdaftar di sistem poin.");console.log("\u2705 User found:",p);const c=a-r,u=p.phone||p.whatsapp;await GASActions.update("user_points",u,{points:c,last_updated:new Date().toLocaleString("id-ID")});const g="CLM-"+Date.now().toString().slice(-6);console.log("\u{1F4DD} Recording claim to sheet:",{claimId:g,phone:n,customerName:e,rewardName:d,requiredPoints:r});try{const b=await ApiService.post("?sheet=claims",{data:[{id:g,phone:n,nama:e,hadiah:d,poin:r,status:"Pending",tanggal:new Date().toLocaleString("id-ID")}]});console.log("\u2705 Claim recorded successfully:",b)}catch(b){console.error("\u274C Error recording claim:",b)}sessionStorage.setItem("user_points",c);const f=document.querySelector("#points-display h4");f&&(f.innerHTML=`${escapeHtml(c.toFixed(1))} <span class="text-sm font-bold">Poin</span>`);const y=`*KLAIM REWARD POIN BERHASIL*

ID Klaim: ${g}
Pelanggan: ${e}
Nomor WhatsApp: ${n}
Reward: ${d}
Poin Ditukar: ${r}
Sisa Poin: ${c.toFixed(1)}

Mohon segera diproses. Terima kasih!`,x=`https://wa.me/628993370200?text=${encodeURIComponent(y)}`;window.claimWhatsAppUrl=x,pendingRewardData={id:null,nama:null,poin:null,gambar:null,deskripsi:null},document.getElementById("name-input-modal").classList.add("hidden"),document.getElementById("confirm-tukar-modal").classList.add("hidden"),setTimeout(()=>{showClaimSuccessModal(g)},300)}catch(o){console.error("Error processing claim:",o),showToast("Gagal memproses penukaran. Silakan coba lagi.")}}const WISHLIST_KEY="gos_wishlist";function getWishlist(){const t=localStorage.getItem(WISHLIST_KEY);return t?JSON.parse(t):[]}function saveWishlist(t){localStorage.setItem(WISHLIST_KEY,JSON.stringify(t)),updateWishlistCount()}function toggleWishlist(t){let e=getWishlist();const n=e.indexOf(t);n>-1?(e.splice(n,1),showToast("Produk dihapus dari Wishlist.")):(e.push(t),showToast("Produk ditambahkan ke Wishlist!")),saveWishlist(e),updateProductWishlistIcon(t);const a=document.getElementById("wishlist-modal");a&&!a.classList.contains("hidden")&&renderWishlistItems()}function isProductInWishlist(t){return getWishlist().includes(t)}function updateWishlistCount(){const t=getWishlist().length,e=document.getElementById("wishlist-count");e&&(e.textContent=t,t>0?e.classList.remove("hidden"):e.classList.add("hidden"))}function updateProductWishlistIcon(t){const e=document.getElementById(`wishlist-btn-${t}`);if(!e)return;const n=isProductInWishlist(t)?'<svg class="w-5 h-5 text-red-500 fill-current" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>':'<svg class="w-5 h-5 text-gray-400 hover:text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>';e.innerHTML=n}function openWishlistModal(){const t=document.getElementById("wishlist-modal");t&&(t.classList.remove("hidden"),document.body.classList.add("modal-active"),renderWishlistItems())}function closeWishlistModal(){const t=document.getElementById("wishlist-modal");t&&(t.classList.add("hidden"),document.body.classList.remove("modal-active"))}async function renderWishlistItems(){const t=getWishlist(),e=document.getElementById("wishlist-items-container");if(console.log("\u{1F50D} Rendering wishlist items:",{wishlistIds:t,containerFound:!!e}),!e)return;if(t.length===0)return void(e.innerHTML=`
            <div class="text-center py-10">
                <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                </svg>
                <p class="text-gray-500 font-semibold">Wishlist Anda kosong.</p>
                <p class="text-gray-400 text-sm mt-2">Tambahkan produk favorit Anda!</p>
            </div>
        `);if(!allProducts||allProducts.length===0){console.log("\u{1F4E6} Fetching products for wishlist...");try{await fetchProducts(),console.log("\u2705 Products fetched:",allProducts.length)}catch(o){return console.error("\u274C Failed to fetch products:",o),void(e.innerHTML='<p class="text-center text-red-500 py-4">Gagal memuat produk. Silakan refresh halaman.</p>')}}const n=new Set(t.map(o=>String(o).trim()));console.log("\u{1F50D} Wishlist Set:",Array.from(n));const a=allProducts.filter(o=>{const s=String(o.productId||"").trim(),r=n.has(s);return r&&console.log("\u2705 Found wishlist product:",s,o.nama),r});console.log("\u{1F4CA} Wishlist products found:",a.length),a.length!==0?(e.innerHTML=a.map(o=>{const s=o.productId,r=parseFloat(o.harga_tunai||o.harga||0),d=o.gambar?String(o.gambar).split(",")[0].trim():"";return`
            <div class="flex items-center justify-between p-4 border-b border-gray-100 hover:bg-gray-50 transition">
                <div class="flex items-center gap-3 flex-1">
                    <img src="${sanitizeUrl(d,"https://placehold.co/100x100?text=Produk")}" alt="${escapeHtml(o.nama)}" class="w-16 h-16 object-cover rounded-lg shadow-sm" data-fallback-src="https://placehold.co/100x100?text=Produk">
                    <div class="flex-1">
                        <p class="font-semibold text-sm text-gray-800">${escapeHtml(o.nama)}</p>
                        <p class="text-xs text-green-600 font-bold mt-1">Rp ${r.toLocaleString("id-ID")}</p>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button type="button" data-action="wishlist-toggle" data-product-id="${s}" class="text-red-500 hover:text-red-700 p-2 transition active:scale-95" title="Hapus dari Wishlist">
                        <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                    </button>
                    <button type="button" data-action="wishlist-buy" data-product-id="${s}" class="bg-green-500 hover:bg-green-600 text-white text-xs font-bold px-3 py-1.5 rounded-lg transition active:scale-95">
                        Beli
                    </button>
                </div>
            </div>
        `}).join(""),console.log("\u2705 Wishlist rendered successfully")):e.innerHTML='<p class="text-center text-gray-500 py-4">Produk tidak ditemukan. Mungkin produk sudah tidak tersedia.</p>'}function showQRISModal(){const t=document.getElementById("qris-modal");t&&t.classList.remove("hidden")}function closeQRISModal(){const t=document.getElementById("qris-modal");t&&t.classList.add("hidden")}async function handleDeepLink(){if(console.log("[DeepLink] Checking for hash:",window.location.hash),allProducts.length===0)return console.log("[DeepLink] Products not loaded yet, waiting..."),void setTimeout(handleDeepLink,500);if(window.location.hash){const t=window.location.hash.substring(1);if(console.log("[DeepLink] Hash found:",t),t.startsWith("produk-")){const e=t.substring(7);console.log("[DeepLink] Looking for product with slug:",e);const n=findProductBySlug(e);n?(console.log("[DeepLink] Product found:",n.nama),setTimeout(()=>{showDetail(n)},500)):console.warn("[DeepLink] Product with slug not found:",e)}}}function showClaimSuccessModal(t){console.log("showClaimSuccessModal called with claimId:",t);const e=document.getElementById("claim-success-modal"),n=document.getElementById("claim-success-id");console.log("Modal element:",e),console.log("Claim ID element:",n),e&&n?(n.textContent=t,e.classList.remove("hidden"),console.log("Modal should now be visible")):console.error("Modal or claimIdElement not found!")}function closeClaimSuccessModal(){const t=document.getElementById("claim-success-modal");t&&t.classList.add("hidden")}function openClaimWhatsApp(){window.claimWhatsAppUrl&&(window.open(window.claimWhatsAppUrl,"_blank"),setTimeout(()=>{closeClaimSuccessModal()},500))}function updatePaymentMethodInfo(t){const e=document.getElementById("payment-method-info"),n=document.getElementById("payment-method-info-text"),a=document.getElementById("qris-display");if(!e||!n)return;const o={tunai:"Pembayaran dilakukan secara tunai saat pesanan diterima atau diambil.",qris:"Pembayaran dilakukan melalui QRIS menggunakan e-wallet atau mobile banking.",gajian:"Pembayaran ditagihkan pada periode gajian berikutnya, jatuh tempo tanggal 6\u20137."};e.classList.contains("hidden")||e.classList.add("opacity-0","scale-95"),a&&!a.classList.contains("hidden")&&a.classList.add("opacity-0","scale-95"),setTimeout(()=>{o[t]?(n.textContent=o[t],e.classList.remove("hidden"),e.offsetWidth,setTimeout(()=>{e.classList.remove("opacity-0","scale-95"),e.classList.add("opacity-100","scale-100")},10)):e.classList.add("hidden"),a&&(t==="qris"?(a.classList.remove("hidden"),a.offsetWidth,setTimeout(()=>{a.classList.remove("opacity-0","scale-95"),a.classList.add("opacity-100","scale-100")},10)):a.classList.add("hidden"))},150)}function openCategorySidebar(){const t=document.getElementById("category-sidebar"),e=document.getElementById("sidebar-overlay");t&&e&&(e.classList.remove("hidden"),setTimeout(()=>{t.classList.remove("-translate-x-full"),t.classList.add("translate-x-0")},10),document.body.style.overflow="hidden",loadSidebarCategories())}function closeCategorySidebar(){const t=document.getElementById("category-sidebar"),e=document.getElementById("sidebar-overlay");t&&e&&(t.classList.remove("translate-x-0"),t.classList.add("-translate-x-full"),setTimeout(()=>{e.classList.add("hidden")},300),document.body.style.overflow="")}function loadSidebarCategories(){const t=document.getElementById("sidebar-category-list");if(!t)return;const e=[...new Set(allProducts.map(o=>o.kategori).filter(o=>o))];e.sort();const n=e.map(o=>{const s=getCategoryIcon(o),r=escapeHtml(o);return`
            <li class="border-b border-gray-100 last:border-0">
                <button type="button" data-action="select-sidebar-category" data-category="${r}" class="flex items-center gap-3 py-3 px-2 hover:bg-green-50 rounded-lg transition group">
                    <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center group-hover:bg-green-200 transition">
                        ${s}
                    </div>
                    <span class="font-semibold text-gray-700 group-hover:text-green-700">${r}</span>
                </button>
            </li>
        `}).join(""),a=t.querySelector("li");t.innerHTML=a?a.outerHTML+n:n}function getCategoryIcon(t){return`
        <svg class="w-6 h-6 text-green-600" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd"/>
        </svg>
    `}function selectSidebarCategory(t){setCategory(t),closeCategorySidebar();const e=document.getElementById("products");e&&e.scrollIntoView({behavior:"smooth",block:"start"})}function updateMobileCartCount(){const t=document.getElementById("mobile-cart-count"),e=document.getElementById("cart-count");if(t&&e){const n=cart.length;n>0?(t.textContent=n,t.classList.remove("hidden")):t.classList.add("hidden")}}document.addEventListener("DOMContentLoaded",updateWishlistCount),window.addEventListener("hashchange",handleDeepLink,!1),document.addEventListener("DOMContentLoaded",()=>{setTimeout(handleDeepLink,1e3)});const originalUpdateCartUI=updateCartUI;updateCartUI=function(){typeof originalUpdateCartUI=="function"&&originalUpdateCartUI(),updateMobileCartCount()},document.addEventListener("DOMContentLoaded",function(){updateMobileCartCount()});
