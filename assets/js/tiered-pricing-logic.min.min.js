function calculateTieredPrice(e,t,r){if(!r)return e;let n=[];if("string"==typeof r)try{n=JSON.parse(r)}catch(t){return console.error("Error parsing tiered prices:",t),e}else n=r;if(!Array.isArray(n)||0===n.length)return e;const i=[...n].sort((e,t)=>t.min_qty-e.min_qty);let s=e;for(const e of i)if(t>=e.min_qty){s=e.price;break}return s}function getNextTierInfo(e,t){if(!t)return null;let r=[];if("string"==typeof t)try{r=JSON.parse(t)}catch(e){return null}else r=t;if(!Array.isArray(r)||0===r.length)return null;const n=[...r].sort((e,t)=>e.min_qty-t.min_qty);for(const t of n)if(e<t.min_qty)return t;return null}function updateTieredPricingUI(e,t=1){const r=document.getElementById("tiered-pricing-ui"),n=document.getElementById("price-tiers-table"),i=document.getElementById("current-tier-badge"),s=document.getElementById("tier-progress-container"),d=document.getElementById("tier-progress-text"),o=document.getElementById("tier-progress-bar"),a=document.getElementById("tier-progress-percent");if(!r||!e.grosir)return void(r&&r.classList.add("hidden"));let c=[];try{c="string"==typeof e.grosir?JSON.parse(e.grosir):e.grosir}catch(e){return void r.classList.add("hidden")}if(!Array.isArray(c)||0===c.length)return void r.classList.add("hidden");r.classList.remove("hidden");const l=[...c].sort((e,t)=>e.min_qty-t.min_qty),u=calculateTieredPrice(e.harga,t,c),g=u<e.harga;i&&(g?(i.classList.remove("hidden"),i.innerText="Harga Grosir Aktif"):i.classList.add("hidden")),n&&(n.innerHTML=l.map(e=>{const r=t>=e.min_qty&&u===e.price;return`\n                <div class="${r?"bg-blue-600 border-blue-600":"bg-white border-blue-100"} border rounded-xl p-2 text-center transition-all duration-300">\n                    <p class="text-[8px] ${r?"text-blue-100":"text-blue-500"} font-bold uppercase leading-tight">Min. ${e.min_qty}</p>\n                    <p class="text-xs ${r?"text-white":"text-blue-800"} font-black">Rp ${e.price.toLocaleString("id-ID")}</p>\n                </div>\n            `}).join(""));const p=getNextTierInfo(t,c);if(p&&s){s.classList.remove("hidden");const e=p.min_qty-t,r=[...l].reverse().find(e=>e.min_qty<=t),n=r?r.min_qty:0,i=p.min_qty-n,c=(t-n)/i*100;d&&(d.innerHTML=`Beli <span class="font-bold">${e} lagi</span> untuk harga <span class="font-bold">Rp ${p.price.toLocaleString("id-ID")}</span>`),o&&(o.style.width=`${c}%`),a&&(a.innerText=`${Math.round(c)}%`)}else s&&s.classList.add("hidden")}"undefined"!=typeof window&&(window.calculateTieredPrice=calculateTieredPrice,window.getNextTierInfo=getNextTierInfo,window.updateTieredPricingUI=updateTieredPricingUI);