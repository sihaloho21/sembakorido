const CONFIG={DEFAULTS:{MAIN_API:"https://script.google.com/macros/s/AKfycbwDmh_cc-J9c0cuzcSThFQBdiZ7lpy3oUjDENZhHW-4UszuKwPB20g6OeRccVsgvp79hw/exec",ADMIN_API:"https://script.google.com/macros/s/AKfycbwDmh_cc-J9c0cuzcSThFQBdiZ7lpy3oUjDENZhHW-4UszuKwPB20g6OeRccVsgvp79hw/exec",VERSION:"1.0.0"},STORAGE_KEYS:{BOOTSTRAP_API:"sembako_bootstrap_api_url",MAIN_API:"sembako_main_api_url",ADMIN_API:"sembako_admin_api_url",GAJIAN_CONFIG:"sembako_gajian_config",REWARD_CONFIG:"sembako_reward_config",STORE_CLOSED:"sembako_store_closed"},_settingsFetched:!1,_lastMainApiUrl:null,_apiChangeCheckInterval:null,getBootstrapApiUrl(){return localStorage.getItem(this.STORAGE_KEYS.BOOTSTRAP_API)||""},setBootstrapApiUrl(e){return!(!e||!e.trim()||(localStorage.setItem(this.STORAGE_KEYS.BOOTSTRAP_API,e.trim()),0))},_detectApiChange(){const e=this.getMainApiUrl();this._lastMainApiUrl&&this._lastMainApiUrl!==e&&("undefined"!=typeof ApiService&&ApiService.clearCache(),sessionStorage.removeItem("runtime_main_api_url"),sessionStorage.removeItem("runtime_admin_api_url"),setTimeout(()=>{window.location.reload()},1e3)),this._lastMainApiUrl=e},startApiChangeMonitoring(e=3e4){this.stopApiChangeMonitoring(),e>0&&(this._apiChangeCheckInterval=setInterval(()=>{this._detectApiChange()},e)),window.addEventListener("api-config-changed",()=>{this._detectApiChange()})},stopApiChangeMonitoring(){this._apiChangeCheckInterval&&(clearInterval(this._apiChangeCheckInterval),this._apiChangeCheckInterval=null)},async fetchSettings(){const e=this.getBootstrapApiUrl();if(!e)return!1;if(this._settingsFetched)return!0;try{const t=await fetch(`${e}?sheet=settings`);if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const i=await t.json(),r={};return i.forEach(e=>{r[e.key]=e.value}),r.main_api_url&&sessionStorage.setItem("runtime_main_api_url",r.main_api_url),r.admin_api_url&&sessionStorage.setItem("runtime_admin_api_url",r.admin_api_url),this._settingsFetched=!0,!0}catch(e){return console.error("‚ùå [CONFIG] Failed to fetch settings:",e),!1}},getMainApiUrl(){const e=sessionStorage.getItem("runtime_main_api_url");if(e)return e;return localStorage.getItem(this.STORAGE_KEYS.MAIN_API)||this.DEFAULTS.MAIN_API},getAdminApiUrl(){const e=sessionStorage.getItem("runtime_admin_api_url");if(e)return e;return localStorage.getItem(this.STORAGE_KEYS.ADMIN_API)||this.DEFAULTS.ADMIN_API},setMainApiUrl(e){return!(!e||!e.trim()||(localStorage.setItem(this.STORAGE_KEYS.MAIN_API,e.trim()),"undefined"!=typeof ApiService&&ApiService.clearCache(),sessionStorage.removeItem("runtime_main_api_url"),0))},setAdminApiUrl(e){return!(!e||!e.trim()||(localStorage.setItem(this.STORAGE_KEYS.ADMIN_API,e.trim()),"undefined"!=typeof ApiService&&ApiService.clearCache(),sessionStorage.removeItem("runtime_admin_api_url"),0))},resetToDefault(e="main"){"main"===e?localStorage.removeItem(this.STORAGE_KEYS.MAIN_API):"admin"===e&&localStorage.removeItem(this.STORAGE_KEYS.ADMIN_API),"undefined"!=typeof ApiService&&ApiService.clearCache(),sessionStorage.removeItem("runtime_main_api_url"),sessionStorage.removeItem("runtime_admin_api_url")},getGajianConfig(){const e=localStorage.getItem(this.STORAGE_KEYS.GAJIAN_CONFIG);if(e)try{return JSON.parse(e)}catch(e){console.error("Error parsing gajian config",e)}return{targetDay:7,markups:[{minDays:29,rate:.2},{minDays:26,rate:.18},{minDays:23,rate:.16},{minDays:20,rate:.14},{minDays:17,rate:.12},{minDays:14,rate:.1},{minDays:11,rate:.08},{minDays:8,rate:.06},{minDays:3,rate:.04},{minDays:0,rate:.02}],defaultMarkup:.25}},setGajianConfig(e){localStorage.setItem(this.STORAGE_KEYS.GAJIAN_CONFIG,JSON.stringify(e))},getRewardConfig(){const e=localStorage.getItem(this.STORAGE_KEYS.REWARD_CONFIG);if(e)try{return JSON.parse(e)}catch(e){console.error("Error parsing reward config",e)}return{pointValue:1e4,minPoint:.1,manualOverrides:{}}},setRewardConfig(e){localStorage.setItem(this.STORAGE_KEYS.REWARD_CONFIG,JSON.stringify(e))},isStoreClosed(){return"true"===localStorage.getItem(this.STORAGE_KEYS.STORE_CLOSED)},setStoreClosed(e){localStorage.setItem(this.STORAGE_KEYS.STORE_CLOSED,e?"true":"false")},getAllConfig(){return{mainApi:this.getMainApiUrl(),adminApi:this.getAdminApiUrl(),gajian:this.getGajianConfig(),reward:this.getRewardConfig(),storeClosed:this.isStoreClosed()}}};
