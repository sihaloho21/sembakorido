function getApiUrl(){const e=CONFIG.getMainApiUrl();return console.log("Using API URL:",e),e}let API_URL=getApiUrl();function refreshApiUrl(){const e=API_URL;API_URL=getApiUrl(),console.log("Old API URL:",e),console.log("New API URL:",API_URL),e!==API_URL&&(console.log("üîÑ API URL changed, clearing cache and reloading..."),"undefined"!=typeof ApiService&&ApiService.clearCache()),fetchProducts()}let cart=JSON.parse(localStorage.getItem("sembako_cart"))||[],allProducts=[],currentCategory="Semua",currentPage=1;const itemsPerPage=12;let filteredProducts=[],storeClosed=CONFIG.isStoreClosed(),selectedVariation=null;function normalizePhoneNumber(e){if(!e)return null;let t=String(e).replace(/[^0-9]/g,"");return t.startsWith("62")&&(t="0"+t.substring(2)),t.startsWith("8")&&!t.startsWith("08")&&(t="0"+t),!t.startsWith("08")||t.length<10||t.length>13?null:t}function createSlug(e){return e?e.toLowerCase().replace(/[^\w\s-]/g,"").trim().replace(/[-\s]+/g,"-"):""}async function fetchProducts(){try{const e=await ApiService.get("?sheet=products",{cacheDuration:3e5});console.log("Products received:",e),allProducts=e.map(e=>{const t=parseInt(e.harga)||0,n="function"==typeof calculateGajianPrice?calculateGajianPrice(t):{price:t,daysLeft:0,markupPercent:0};let a=e.kategori||"Bahan Pokok";e.kategori||(t>=15e4?a="Paket Lengkap":t>=5e4&&(a="Paket Hemat"));let o=[];if(e.variasi)try{o=JSON.parse(e.variasi)}catch(t){console.error("Error parsing variations for product:",e.id,t)}return{...e,harga:t,hargaCoret:parseInt(e.harga_coret)||0,hargaGajian:n.price,stok:parseInt(e.stok)||0,category:a,deskripsi:e.deskripsi&&""!==e.deskripsi.trim()?e.deskripsi:"Kualitas Terjamin, Stok Selalu Baru, Harga Kompetitif",variations:o,slug:createSlug(e.nama)}}),filterProducts(),updateCartUI(),checkStoreStatus(),startNotificationLoop()}catch(e){console.error("Error fetching products:",e);const t=document.getElementById("product-grid");t&&(t.innerHTML='<p class="text-center col-span-full text-red-500">Gagal memuat produk. Silakan coba lagi nanti.</p>')}}function findProductBySlug(e){return e&&allProducts&&0!==allProducts.length?allProducts.find(t=>t.slug===e):null}function renderProducts(e){const t=document.getElementById("product-grid");if(!t)return;if(0===e.length)return t.innerHTML='<p class="text-center col-span-full text-gray-500 py-10">Tidak ada produk yang ditemukan.</p>',void(document.getElementById("pagination-container").innerHTML="");const n=Math.ceil(e.length/12);currentPage>n&&(currentPage=n||1);const a=12*(currentPage-1),o=a+12,s=e.slice(a,o);t.innerHTML="",s.forEach(e=>{let n="";n=e.stok>5?'<span class="bg-green-100 text-green-700 text-[10px] px-2 py-0.5 rounded-full font-bold">Stok Tersedia</span>':e.stok>0?`<span class="bg-orange-100 text-orange-700 text-[10px] px-2 py-0.5 rounded-full font-bold">Stok Terbatas (${e.stok})</span>`:'<span class="bg-red-100 text-red-700 text-[10px] px-2 py-0.5 rounded-full font-bold">Stok Habis</span>';const a=JSON.stringify(e).replace(/'/g,"\\'").replace(/"/g,"&quot;"),o=(e.gambar?e.gambar.split(","):[])[0]||"https://placehold.co/300x200?text=Produk",s=calculateRewardPoints(e.harga,e.nama);let i="",r=!1;if(e.grosir)try{const t=JSON.parse(e.grosir);if(Array.isArray(t)&&t.length>0){r=!0;i=`\n                        <div class="grid grid-cols-3 gap-2 mb-3">\n                            ${[...t].sort((e,t)=>e.min_qty-t.min_qty).map(e=>`\n                        <div class="bg-green-50 border border-green-100 rounded-lg p-1.5 text-center">\n                            <p class="text-[8px] text-green-600 font-bold uppercase leading-tight">Min. ${e.min_qty}</p>\n                            <p class="text-[10px] text-green-700 font-black">Rp ${e.price.toLocaleString("id-ID")}</p>\n                        </div>\n                    `).join("")}\n                        </div>\n                    `}}catch(t){console.error("Error parsing grosir data for product:",e.id,t)}let l="";if(e.hargaCoret>e.harga){const t=Math.round((e.hargaCoret-e.harga)/e.hargaCoret*100);l=`\n                <div class="flex items-center gap-1 mb-0.5">\n                    <span class="text-[10px] text-gray-400 line-through">Rp ${e.hargaCoret.toLocaleString("id-ID")}</span>\n                    <span class="bg-red-500 text-white text-[8px] px-1.5 py-0.5 rounded font-bold">-${t}%</span>\n                </div>\n            `}const d=e.variations&&e.variations.length>0,c=e.id||e.sku,u=isProductInWishlist(c)?'<svg class="w-5 h-5 text-red-500 fill-current" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>':'<svg class="w-5 h-5 text-gray-400 hover:text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>';t.innerHTML+=`\n            <div class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition duration-300 relative">\n                \x3c!-- Wishlist Heart Button --\x3e\n                <button id="wishlist-btn-${c}" onclick="toggleWishlist('${c}'); event.stopPropagation();" class="absolute top-3 right-3 z-20 p-2 bg-white/90 hover:bg-white rounded-full shadow-md transition active:scale-95">\n                    ${u}\n                </button>\n                <div class="absolute top-3 left-3 z-10 flex flex-col gap-2">\n                    <div class="bg-amber-400 text-white text-[10px] font-bold px-2 py-1 rounded-lg shadow-sm flex items-center gap-1">\n                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>\n                        +${s} Poin\n                    </div>\n                    ${r?'\n                    <div class="bg-green-600 text-white text-[10px] font-bold px-2 py-1 rounded-lg shadow-sm flex items-center gap-1">\n                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7c.78.78.78 2.047 0 2.828l-7 7c-.78.78-2.047.78-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path></svg>\n                        Harga Grosir Tersedia\n                    </div>\n                    ':""}\n                </div>\n                <div class="lazy-image-wrapper">\n                    <div class="skeleton skeleton-product-image"></div>\n                    <img src="${o}" alt="${e.nama}" onclick='showDetail(${a})' class="w-full h-48 object-cover cursor-pointer hover:opacity-90 transition-opacity ${0===e.stok?"grayscale opacity-60":""}" loading="lazy" onerror="this.src='https://placehold.co/300x200?text=Produk'" onload="this.classList.add('loaded'); this.previousElementSibling.style.display='none';">\n                </div>\n                <div class="p-6">\n                    <div class="flex justify-between items-start mb-2">\n                        <h4 class="text-lg font-bold text-gray-800">${e.nama}</h4>\n                        ${n}\n                    </div>\n                    <div class="flex justify-between items-center mb-4">\n                        <button onclick="shareProduct('${e.nama}')" class="text-green-600 hover:text-green-700 flex items-center gap-1 text-xs font-medium">\n                            <span>Share</span>\n                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.335-1.662c1.72.937 3.659 1.432 5.631 1.433h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>\n                        </button>\n                    </div>\n                    <div class="grid grid-cols-2 gap-4 mb-6">\n                        <div class="bg-green-50 p-3 rounded-lg">\n                            <p class="text-[10px] text-green-600 font-bold uppercase">Harga Cash</p>\n                            <div class="flex flex-col">\n                                ${l}\n                                <p class="text-lg font-bold text-green-700">Rp ${e.harga.toLocaleString("id-ID")}</p>\n                            </div>\n                        </div>\n                        <div class="bg-blue-50 p-3 rounded-lg">\n                            <p class="text-[10px] text-blue-600 font-bold uppercase">Bayar Gajian</p>\n                            <div class="flex flex-col">\n                                <p class="text-[8px] text-blue-400 mb-0.5">Harga Per Tgl ${(new Date).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"}).replace(/\//g,"-")}</p>\n                                <p class="text-lg font-bold text-blue-700">Rp ${e.hargaGajian.toLocaleString("id-ID")}</p>\n                            </div>\n                        </div>\n                    </div>\n                    ${i}\n                    ${d?`\n                    <button onclick='showDetail(${a}); event.stopPropagation();' class="w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 rounded-xl transition flex items-center justify-center gap-2 mb-3">\n                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>\n                        Pilih Variasi\n                    </button>\n                    `:`\n                    <button onclick='addToCart(${a}, event)' ${0===e.stok?"disabled":""} class="w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-300 text-white font-bold py-3 rounded-xl transition flex items-center justify-center gap-2 mb-3">\n                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>\n                        Tambah ke Keranjang\n                    </button>\n                    `}\n                    <div class="grid grid-cols-2 gap-2">\n                        <button onclick='showDetail(${a}); event.stopPropagation();' class="bg-gray-100 hover:bg-gray-200 text-gray-600 font-bold py-2 rounded-lg text-sm transition">Rincian</button>\n                        <button onclick='directOrder(${a}); event.stopPropagation();' ${0===e.stok?"disabled":""} class="bg-green-100 hover:bg-green-200 text-green-700 font-bold py-2 rounded-lg text-sm transition">Beli Sekarang</button>\n                    </div>\n\n                </div>\n            </div>\n        `})}function filterProducts(){const e=document.getElementById("search-input").value.toLowerCase();filteredProducts=allProducts.filter(t=>{const n=t.nama.toLowerCase().includes(e)||t.deskripsi&&t.deskripsi.toLowerCase().includes(e),a="Semua"===currentCategory||t.category===currentCategory;return n&&a}),currentPage=1,renderProducts(filteredProducts),renderPagination(filteredProducts.length)}function renderPagination(e){const t=document.getElementById("pagination-container");if(!t)return;const n=Math.ceil(e/12);if(n<=1)return void(t.innerHTML="");let a="";a+=`\n        <button onclick="changePage(${currentPage-1})" ${1===currentPage?"disabled":""} \n            class="w-10 h-10 flex items-center justify-center rounded-lg border-2 border-gray-200 text-gray-600 hover:border-green-500 hover:text-green-600 disabled:opacity-30 disabled:cursor-not-allowed transition">\n            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>\n        </button>\n    `;for(let e=1;e<=n;e++)1===e||e===n||e>=currentPage-1&&e<=currentPage+1?a+=`\n                <button onclick="changePage(${e})" \n                    class="w-10 h-10 flex items-center justify-center rounded-lg border-2 font-bold transition ${e===currentPage?"bg-green-600 border-green-600 text-white":"border-gray-200 text-gray-600 hover:border-green-500 hover:text-green-600"}">\n                    ${e}\n                </button>\n            `:e!==currentPage-2&&e!==currentPage+2||(a+='<span class="text-gray-400">...</span>');a+=`\n        <button onclick="changePage(${currentPage+1})" ${currentPage===n?"disabled":""} \n            class="w-10 h-10 flex items-center justify-center rounded-lg border-2 border-gray-200 text-gray-600 hover:border-green-500 hover:text-green-600 disabled:opacity-30 disabled:cursor-not-allowed transition">\n            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>\n        </button>\n    `,t.innerHTML=a}function changePage(e){const t=Math.ceil(filteredProducts.length/12);e<1||e>t||(currentPage=e,renderProducts(filteredProducts),renderPagination(filteredProducts.length),document.getElementById("katalog").scrollIntoView({behavior:"smooth"}))}function setCategory(e){currentCategory=e,document.querySelectorAll(".filter-btn").forEach(t=>{t.innerText===e?t.classList.add("active"):t.classList.remove("active")}),filterProducts()}function addToCart(e,t,n=1){storeClosed?showStoreWarning(()=>{proceedAddToCart(e,t,n)}):proceedAddToCart(e,t,n)}function proceedAddToCart(e,t,n=1){if(e.variations&&e.variations.length>0&&!selectedVariation)return void showDetail(e);const a={...e};if(selectedVariation){a.selectedVariation=selectedVariation,a.harga=selectedVariation.harga,a.sku=selectedVariation.sku,a.stok=selectedVariation.stok;const e="function"==typeof calculateGajianPrice?calculateGajianPrice(selectedVariation.harga):{price:selectedVariation.harga,daysLeft:0,markupPercent:0};a.hargaGajian=e.price}const o=cart.find(e=>{const t=e.id===a.id,n=!e.selectedVariation&&!a.selectedVariation||e.selectedVariation&&a.selectedVariation&&e.selectedVariation.sku===a.selectedVariation.sku;return t&&n});if(o?o.qty+=n:cart.push({...a,qty:n}),saveCart(),updateCartUI(),selectedVariation=null,t&&t.currentTarget){const e=(t.currentTarget.closest(".bg-white")||document.getElementById("detail-modal")).querySelector("img"),n=document.querySelector("header button");if(e&&n){const t=e.getBoundingClientRect(),a=n.getBoundingClientRect(),o=document.createElement("img");o.src=e.src,o.className="fly-item",o.style.top=`${t.top}px`,o.style.left=`${t.left}px`,o.style.width=`${t.width}px`,o.style.height=`${t.height}px`,o.style.borderRadius="12px",document.body.appendChild(o),requestAnimationFrame(()=>{o.style.top=`${a.top+a.height/2}px`,o.style.left=`${a.left+a.width/2}px`,o.style.width="20px",o.style.height="20px",o.style.opacity="0.5",o.style.borderRadius="50%"}),setTimeout(()=>{o.remove(),n.classList.add("cart-pop"),setTimeout(()=>n.classList.remove("cart-pop"),400)},800)}}else{const e=document.querySelector("header button");e&&(e.classList.add("cart-pop"),setTimeout(()=>e.classList.remove("cart-pop"),400))}showToast(`${a.nama}${a.selectedVariation?" ("+a.selectedVariation.nama+")":""} ditambahkan ke keranjang`)}function showToast(e){let t=document.querySelector(".toast-container");t||(t=document.createElement("div"),t.className="toast-container",document.body.appendChild(t));const n=document.createElement("div");n.className="toast",n.innerHTML=`\n        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>\n        </svg>\n        <span>${e}</span>\n    `,t.appendChild(n),setTimeout(()=>n.remove(),3e3)}function showSuccessNotification(e,t){const n=document.createElement("div");n.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[100] animate-fade-in",n.style.animation="fadeIn 0.3s ease-out";const a=document.createElement("div");if(a.className="bg-white rounded-2xl shadow-2xl p-8 max-w-sm mx-4 text-center transform scale-95 relative",a.style.animation="scaleIn 0.3s ease-out forwards",a.innerHTML=`\n        <button onclick="this.closest('.fixed').remove()" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition p-1 rounded-full hover:bg-gray-100">\n            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>\n            </svg>\n        </button>\n        <div class="mb-4">\n            <div class="w-32 h-32 flex items-center justify-center mx-auto mb-4">\n                <img src="assets/images/success-shield.gif" alt="Success" class="w-full h-full object-contain">\n            </div>\n            <h3 class="text-2xl font-bold text-gray-800 mb-2">Pesanan Berhasil Dikirim!</h3>\n            <p class="text-gray-600 mb-4">Order ID: <span class="font-mono font-semibold text-green-600">${e}</span></p>\n            <p class="text-sm text-gray-500 mb-6">Pesanan Anda telah tercatat dan akan segera diproses. Silakan lanjutkan ke WhatsApp untuk konfirmasi.</p>\n        </div>\n        <a href="${t}" target="_blank" class="block w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-xl transition shadow-lg flex items-center justify-center gap-3 mt-4">\n            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.335-1.662c1.72.937 3.659 1.432 5.631 1.433h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>\n            <span>Lanjut ke WhatsApp</span>\n        </a>\n    `,n.appendChild(a),document.body.appendChild(n),!document.getElementById("success-notification-styles")){const e=document.createElement("style");e.id="success-notification-styles",e.textContent="\n            @keyframes fadeIn {\n                from { opacity: 0; }\n                to { opacity: 1; }\n            }\n            @keyframes scaleIn {\n                from { transform: scale(0.95); opacity: 0; }\n                to { transform: scale(1); opacity: 1; }\n            }\n            @keyframes fadeOut {\n                from { opacity: 1; }\n                to { opacity: 0; }\n            }\n            @keyframes successCircle {\n                0% {\n                    transform: scale(0);\n                    opacity: 0;\n                }\n                50% {\n                    transform: scale(1.1);\n                }\n                100% {\n                    transform: scale(1);\n                    opacity: 1;\n                }\n            }\n            @keyframes successCheck {\n                0% {\n                    stroke-dashoffset: 50;\n                    opacity: 0;\n                }\n                50% {\n                    opacity: 1;\n                }\n                100% {\n                    stroke-dashoffset: 0;\n                }\n            }\n            @keyframes bounce {\n                0%, 100% {\n                    transform: translateY(0);\n                }\n                50% {\n                    transform: translateY(-10px);\n                }\n            }\n            .animate-success-circle {\n                animation: successCircle 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;\n            }\n            .animate-success-check {\n                animation: successCheck 0.6s ease-in-out 0.3s forwards, bounce 0.6s ease-in-out 0.9s;\n            }\n            .checkmark-path {\n                stroke-dasharray: 50;\n                stroke-dashoffset: 50;\n            }\n        ",document.head.appendChild(e)}n.addEventListener("click",e=>{e.target===n&&(n.style.animation="fadeOut 0.3s ease-out",setTimeout(()=>n.remove(),300))})}function saveCart(){localStorage.setItem("sembako_cart",JSON.stringify(cart))}function updateCartUI(){const e=cart.reduce((e,t)=>e+t.qty,0),t=document.getElementById("cart-count");t&&(e>0?(t.innerText=e,t.classList.remove("hidden")):t.classList.add("hidden"));const n=document.getElementById("cart-items"),a=document.getElementById("cart-footer"),o=document.getElementById("cart-empty");if(n)if(0===cart.length)n.innerHTML="",a&&a.classList.add("hidden"),o&&o.classList.remove("hidden");else{o&&o.classList.add("hidden"),a&&a.classList.remove("hidden");let e=0;n.innerHTML=cart.map((t,n)=>{const a=calculateTieredPrice(t.harga,t.qty,t.grosir),o=a<t.harga,s=a*t.qty;e+=s;let i=(t.gambar?t.gambar.split(","):[])[0]||"https://placehold.co/100x100?text=Produk";return t.selectedVariation&&t.selectedVariation.gambar&&(i=t.selectedVariation.gambar),`\n                <div class="flex items-center gap-4 bg-gray-50 p-3 rounded-xl">\n                    <img src="${i}" class="w-16 h-16 object-cover rounded-lg">\n                    <div class="flex-1">\n                        <h5 class="font-bold text-gray-800 text-sm">${t.nama}${t.selectedVariation?" ("+t.selectedVariation.nama+")":""}</h5>\n                        <div class="flex flex-col">\n                            ${o?`<span class="text-[10px] text-gray-400 line-through">Rp ${t.harga.toLocaleString("id-ID")}</span>`:""}\n                            <p class="text-green-600 font-bold text-xs">Rp ${a.toLocaleString("id-ID")} ${o?'<span class="bg-green-100 text-green-700 text-[8px] px-1 rounded ml-1">Grosir</span>':""}</p>\n                        </div>\n                        <div class="flex items-center gap-3 mt-2">\n                            <button onclick="updateQty(${n}, -1)" class="w-6 h-6 bg-white border border-gray-200 rounded-full flex items-center justify-center text-gray-500">-</button>\n                            <span class="text-sm font-bold">${t.qty}</span>\n                            <button onclick="updateQty(${n}, 1)" class="w-6 h-6 bg-white border border-gray-200 rounded-full flex items-center justify-center text-gray-500">+</button>\n                        </div>\n                    </div>\n                    <button onclick="removeItem(${n})" class="text-red-400 hover:text-red-600">\n                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>\n                    </button>\n                </div>\n            `}).join("");const t=document.getElementById("cart-total");t&&(t.innerText=`Rp ${e.toLocaleString("id-ID")}`)}}function updateQty(e,t){cart[e].qty+=t,cart[e].qty<1&&cart.splice(e,1),saveCart(),updateCartUI()}function removeItem(e){cart.splice(e,1),saveCart(),updateCartUI()}function openCartModal(){const e=document.getElementById("cart-modal");e&&(e.classList.remove("hidden"),document.body.classList.add("modal-active"))}function closeCartModal(){const e=document.getElementById("cart-modal");e&&(e.classList.add("hidden"),document.body.classList.remove("modal-active"))}function updateModalQty(e){const t=document.getElementById("modal-qty");if(!t)return;let n=parseInt(t.value)||1;n+=e,n<1&&(n=1),t.value=n,t.oninput({target:t})}function showDetail(e){closeWishlistModal(),console.log("showDetail called for product:",e.nama);const t=document.getElementById("detail-modal");if(!t)return;selectedVariation=null;const n=document.getElementById("modal-qty");n&&(n.value=1);const a=document.getElementById("modal-product-name"),o=document.getElementById("modal-product-image"),s=(document.getElementById("modal-cash-price"),document.getElementById("modal-gajian-price"),document.getElementById("modal-price-date")),i=document.getElementById("modal-items-list"),r=document.getElementById("modal-badges"),l=(document.getElementById("savings-highlight"),document.getElementById("savings-amount"),document.getElementById("modal-variation-container"));a&&(a.innerText=e.nama),n&&(n.oninput=t=>{const n=parseInt(t.target.value)||1,a=selectedVariation?selectedVariation.harga:e.harga,o=selectedVariation?selectedVariation.grosir:e.grosir,s=selectedVariation?selectedVariation.harga_coret||0:e.hargaCoret||0;"function"==typeof updateTieredPricingUI&&updateTieredPricingUI({...e,harga:a,grosir:o},n);const i="function"==typeof calculateTieredPrice?calculateTieredPrice(a,n,o):a;updateModalPrices(i*n,("function"==typeof calculateGajianPrice?calculateGajianPrice(i):{price:i}).price*n,s*n)}),l?e.variations&&e.variations.length>0?(l.classList.remove("hidden"),document.getElementById("modal-variation-list").innerHTML=e.variations.map((e,t)=>`\n\t                <button onclick='selectVariation(${JSON.stringify(e).replace(/'/g,"\\'").replace(/"/g,"&quot;")}, ${t})' class="variation-btn border-2 border-gray-200 rounded-xl p-3 text-left transition hover:border-green-500 focus:outline-none" data-index="${t}">\n                    <p class="text-xs font-bold text-gray-800">${e.nama}</p>\n                    <p class="text-[10px] text-green-600 font-bold">Rp ${e.harga.toLocaleString("id-ID")}</p>\n                    ${e.stok<=0?'<p class="text-[8px] text-red-500 font-bold">Stok Habis</p>':""}\n                </button>\n            `).join(""),selectVariation(e.variations[0],0)):(l.classList.add("hidden"),updateModalPrices(e.harga,e.hargaGajian,e.hargaCoret)):updateModalPrices(e.harga,e.hargaGajian,e.hargaCoret),s&&(s.innerText=`Harga Per Tgl ${(new Date).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"}).replace(/\//g,"-")}`),r&&(r.innerHTML=`\n            <span class="bg-green-100 text-green-700 text-[10px] px-2.5 py-1 rounded-lg font-bold">${e.category}</span>\n            ${e.stok>0?`<span class="bg-blue-100 text-blue-700 text-[10px] px-2.5 py-1 rounded-lg font-bold">Stok: ${e.stok}</span>`:'<span class="bg-red-100 text-red-700 text-[10px] px-2.5 py-1 rounded-lg font-bold">Stok Habis</span>'}\n        `);const d=e.gambar?e.gambar.split(","):[];if("function"==typeof initializeSlider?initializeSlider(d):o&&(o.src=d.length>0?d[0]:"https://placehold.co/300x200?text=Produk",o.onerror=function(){this.src="https://placehold.co/300x200?text=Produk"}),i){const t=e.deskripsi.split("\n").filter(e=>""!==e.trim()),n=["üçú","üç≤","üì¶","‚òï","üçö","üç≥","üßÇ"];i.innerHTML=t.map((e,t)=>`\n            <div class="flex items-center gap-4 bg-gray-50/50 p-3 rounded-xl border border-gray-100/50">\n                <span class="text-xl">${n[t%n.length]}</span>\n                <span class="text-sm font-medium text-gray-700">${e.trim()}</span>\n            </div>\n        `).join("")}"function"==typeof updateTieredPricingUI&&updateTieredPricingUI(e,1),t.classList.remove("hidden"),document.body.classList.add("modal-active")}function selectVariation(e,t){if(selectedVariation=e,document.querySelectorAll(".variation-btn").forEach((e,n)=>{n===t?(e.classList.add("border-green-500","bg-green-50"),e.classList.remove("border-gray-200")):(e.classList.remove("border-green-500","bg-green-50"),e.classList.add("border-gray-200"))}),e.gambar&&"function"==typeof initializeSlider){const t=e.gambar.split(",");initializeSlider(t)}const n=document.getElementById("modal-qty");if(n)n.oninput({target:n});else{const t="function"==typeof calculateGajianPrice?calculateGajianPrice(e.harga):{price:e.harga,daysLeft:0,markupPercent:0};updateModalPrices(e.harga,t.price,e.harga_coret||0)}}function updateModalPrices(e,t,n){const a=document.getElementById("modal-cash-price"),o=document.getElementById("modal-gajian-price"),s=document.getElementById("savings-highlight"),i=document.getElementById("savings-amount");a&&(a.innerText=`Rp ${e.toLocaleString("id-ID")}`),o&&(o.innerText=`Rp ${t.toLocaleString("id-ID")}`),n>e?(s&&s.classList.remove("hidden"),i&&(i.innerText=`Rp ${(n-e).toLocaleString("id-ID")}`)):s&&s.classList.add("hidden")}function closeDetailModal(){const e=document.getElementById("detail-modal");e&&(e.classList.add("hidden"),document.body.classList.remove("modal-active")),selectedVariation=null}function directOrder(e){storeClosed?showStoreWarning(()=>{proceedDirectOrder(e)}):proceedDirectOrder(e)}function proceedDirectOrder(e){if(e.variations&&e.variations.length>0&&!selectedVariation)return void showDetail(e);const t={...e};if(selectedVariation){t.selectedVariation=selectedVariation,t.harga=selectedVariation.harga,t.sku=selectedVariation.sku,t.stok=selectedVariation.stok;const e="function"==typeof calculateGajianPrice?calculateGajianPrice(selectedVariation.harga):{price:selectedVariation.harga,daysLeft:0,markupPercent:0};t.hargaGajian=e.price}const n=document.getElementById("modal-qty"),a=n&&parseInt(n.value)||1;cart=[{...t,qty:a}],saveCart(),updateCartUI(),openOrderModal(),selectedVariation=null}function directOrderFromModal(){const e=document.getElementById("modal-product-name").innerText,t=allProducts.find(t=>t.nama===e);t&&(directOrder(t),closeDetailModal())}function checkStoreStatus(){storeClosed=CONFIG.isStoreClosed();const e=document.getElementById("store-closed-banner"),t=document.getElementById("main-header");storeClosed?(e&&e.classList.remove("hidden"),t&&(t.style.top="36px"),sessionStorage.getItem("store_closed_modal_shown")||setTimeout(()=>{document.getElementById("store-closed-modal").classList.remove("hidden"),sessionStorage.setItem("store_closed_modal_shown","true")},1e3)):(e&&e.classList.add("hidden"),t&&(t.style.top="0"))}function closeStoreClosedModal(){document.getElementById("store-closed-modal").classList.add("hidden")}function showStoreWarning(e){const t=document.getElementById("store-warning-modal"),n=document.getElementById("confirm-store-warning");t.classList.remove("hidden"),n.onclick=()=>{t.classList.add("hidden"),e&&e()}}function closeStoreWarningModal(){document.getElementById("store-warning-modal").classList.add("hidden")}function openOrderModal(){if(0===cart.length)return;closeCartModal();const e=document.getElementById("order-summary"),t=document.querySelector('input[name="pay-method"]:checked'),n=t&&"Bayar Gajian"===t.value;if(e){let t=0;e.innerHTML=cart.map(e=>{const a=n?e.hargaGajian:e.harga,o=calculateTieredPrice(a,e.qty,e.grosir),s=o<a,i=calculateRewardPoints(e.harga,e.nama)*e.qty;return t+=i,`\n                <div class="flex justify-between items-center py-1">\n                    <div class="flex flex-col">\n                        <span class="font-medium">${e.nama}${e.selectedVariation?" ("+e.selectedVariation.nama+")":""} (x${e.qty})</span>\n                        <div class="flex items-center gap-2">\n                            <span class="text-[10px] text-amber-600 font-bold flex items-center gap-1">\n                                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>\n                                +${i.toFixed(1)} Poin\n                            </span>\n                            ${s?'<span class="bg-green-100 text-green-700 text-[8px] px-1 rounded font-bold">Harga Grosir</span>':""}\n                        </div>\n                    </div>\n                    <div class="flex flex-col items-end">\n                        ${s?`<span class="text-[10px] text-gray-400 line-through">Rp ${(a*e.qty).toLocaleString("id-ID")}</span>`:""}\n                        <span class="font-bold">Rp ${(o*e.qty).toLocaleString("id-ID")}</span>\n                    </div>\n                </div>\n            `}).join(""),e.innerHTML+=`\n            <div class="border-t border-dashed border-gray-200 mt-2 pt-2 flex justify-between items-center">\n                <span class="text-xs font-bold text-amber-700">Total Poin Didapat:</span>\n                <span class="text-sm font-black text-amber-700 flex items-center gap-1">\n                    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>\n                    ${t.toFixed(1)} Poin\n                </span>\n            </div>\n        `}updateOrderTotal();const a=document.getElementById("order-modal");a&&(a.classList.remove("hidden"),document.body.classList.add("modal-active"))}function closeOrderModal(){const e=document.getElementById("order-modal");e&&(e.classList.add("hidden"),document.body.classList.remove("modal-active"))}function shareProduct(e){const t=`Cek paket sembako murah "${e}" di GoSembako! Kualitas terjamin, harga bersahabat.`,n=window.location.href,a=`https://wa.me/?text=${encodeURIComponent(t+" "+n)}`;window.open(a,"_blank")}function startNotificationLoop(){const e=["Siti","Budi","Ani","Joko","Rina","Agus","Dewi","Eko"],t=allProducts.length>0?allProducts.map(e=>e.nama):["Paket Sembako"];setInterval(()=>{Math.random()>.7&&showNotification(`${e[Math.floor(Math.random()*e.length)]} baru saja membeli ${t[Math.floor(Math.random()*t.length)]}`)},15e3)}function showNotification(e){const t=document.createElement("div");t.className="fixed bottom-24 left-4 bg-white/90 backdrop-blur shadow-lg rounded-xl p-3 flex items-center gap-3 border border-green-100 z-50 animate-bounce",t.innerHTML=`\n        <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center text-green-600">\n            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a8 8 0 100 16 8 8 0 000-16zm1 11H9v-2h2v2zm0-4H9V5h2v4z"></path></svg>\n        </div>\n        <p class="text-xs font-medium text-gray-700">${e}</p>\n    `,document.body.appendChild(t),setTimeout(()=>t.remove(),5e3)}function toggleLocationField(){const e=document.querySelector('input[name="ship-method"]:checked'),t=document.getElementById("location-field"),n=document.getElementById("delivery-location-ui"),a=document.getElementById("pickup-location-ui");e&&("Antar Nikomas"===e.value?(t.classList.add("hidden"),n.classList.add("hidden"),a.classList.add("hidden")):"Antar Kerumah"===e.value?(t.classList.remove("hidden"),n.classList.remove("hidden"),a.classList.add("hidden")):"Ambil Ditempat"===e.value&&(t.classList.remove("hidden"),n.classList.add("hidden"),a.classList.remove("hidden"))),updateOrderTotal()}function getCurrentLocation(){const e=document.getElementById("get-location-btn"),t=document.getElementById("location-link");navigator.geolocation?(e.disabled=!0,e.innerHTML="<span>‚åõ Mengambil Lokasi...</span>",navigator.geolocation.getCurrentPosition(n=>{const a=`https://www.google.com/maps?q=${n.coords.latitude},${n.coords.longitude}`;t.value=a,e.classList.remove("bg-white","text-blue-700","border-blue-200"),e.classList.add("bg-green-600","text-white","border-green-600"),e.innerHTML="<span>‚úÖ Lokasi Berhasil Dibagikan</span>",alert("Lokasi berhasil diambil!")},t=>{e.disabled=!1,e.innerHTML="<span>üìç Bagikan Lokasi Saya</span>";let n="Gagal mengambil lokasi.";1===t.code&&(n="Mohon izinkan akses lokasi untuk fitur ini."),alert(n)},{enableHighAccuracy:!0,timeout:5e3,maximumAge:0})):alert("Geolocation tidak didukung oleh browser Anda")}function updateOrderTotal(){const e=document.querySelector('input[name="pay-method"]:checked'),t=document.querySelector('input[name="ship-method"]:checked'),n=e&&"Bayar Gajian"===e.value,a=t&&"Antar Nikomas"===t.value;let o=0;cart.forEach(e=>{const t=n?e.hargaGajian:e.harga,a=calculateTieredPrice(t,e.qty,e.grosir);o+=a*e.qty});const s=a?2e3:0,i=o+s,r=document.getElementById("sticky-order-total");r&&(r.innerText=`Rp ${i.toLocaleString("id-ID")}`);const l=document.getElementById("order-subtotal"),d=document.getElementById("order-shipping");l&&(l.innerText=`Rp ${o.toLocaleString("id-ID")}`),d&&(d.innerText=`Rp ${s.toLocaleString("id-ID")}`)}function normalizePhone(e){if(!e)return"";let t=e.toString().replace(/[^0-9]/g,"");return t.startsWith("62")?t="0"+t.slice(2):t.startsWith("8")?t="0"+t:t.startsWith("0")||(t="0"+t),t.startsWith("0")&&!t.startsWith("08")&&t.length,t}function generateOrderId(){let e="";for(let t=0;t<6;t++)e+="0123456789".charAt(Math.floor(10*Math.random()));return`ORD-${e}`}function sendToWA(){const e=event?.target||document.querySelector('button[onclick="sendToWA()"]');if(e&&e.disabled)return;const t=document.getElementById("customer-name").value,n=document.getElementById("customer-phone").value,a=document.querySelector('input[name="pay-method"]:checked')?.value,o=document.querySelector('input[name="ship-method"]:checked')?.value;if(!t||0===t.trim().length)return void alert("Masukkan Nama Lengkap");const s=t.replace(/\s/g,"");if(s.length<4)return void alert("Masukkan Nama Lengkap");const i=s.toLowerCase(),r=[/^(.)\1{3,}$/,/^(.{2})\1{2,}$/,/^(.{3})\1{2,}$/,/^([a-z])([a-z])\1\2{2,}$/];for(const e of r)if(e.test(i))return void alert("Masukkan Nama Lengkap");if(!n||0===n.trim().length)return void alert("Nomor WhatsApp tidak valid");const l=n.replace(/[^0-9]/g,"");if(l.length<10)return void alert("Nomor WhatsApp tidak valid");const d=[/^(\d)\1{9,}$/,/^08(\d)\1{8,}$/,/^(\d{2})\1{4,}$/,/^(\d{3})\1{3,}$/];for(const e of d)if(e.test(l))return void alert("Nomor WhatsApp tidak valid");if(!a)return void alert("Pilih metode pembayaran terlebih dahulu");if(!o)return void alert("Pilih metode pengiriman terlebih dahulu");e&&(e.disabled=!0,e.innerHTML='\n            <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">\n                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>\n                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>\n            </svg>\n            <span>Memproses Pesanan...</span>\n        ',e.classList.add("opacity-75","cursor-not-allowed"));let c="";c="Antar Nikomas"===o?"Antar Nikomas (Area PT Nikomas Gemilang)":"Antar Kerumah"===o?"Antar Kerumah (Area Serang & sekitarnya)":"Ambil Ditempat (Kp. Baru, Kec. Kibin)";const u="Bayar Gajian"===a;let m=0,g=0,p="",h="";cart.forEach((e,t)=>{const n=u?e.hargaGajian:e.harga,a=calculateTieredPrice(n,e.qty,e.grosir),o=a<n,s=a*e.qty;m+=s,g+=e.qty;const i=e.selectedVariation?` (${e.selectedVariation.nama})`:"",r=o?` (Harga Grosir: Rp ${a.toLocaleString("id-ID")}/unit)`:"";p+=`${t+1}. ${e.nama}${i} x${e.qty}${r} = Rp ${s.toLocaleString("id-ID")}\n`,h+=`${e.nama}${i} (x${e.qty}) | `});const f="Antar Nikomas"===o?2e3:0;m+=f;const y=CONFIG.getRewardConfig().pointValue||1e4,v=Math.floor(m/y),b=generateOrderId(),x=document.getElementById("location-link")?.value||"",k=`*PESANAN BARU - GOSEMBAKO*\n\n*Order ID: ${b}*\n*Data Pelanggan:*\nNama: ${t}\nWhatsApp: ${n}\n\n*Detail Pesanan:*\n${p}\n*Metode Pembayaran:* ${a}\n*Metode Pengiriman:* ${o}\n*Lokasi/Titik:* ${c}${x?`\n*Lokasi Maps:* ${x}`:""}\n\n*Ongkir:* Rp ${f.toLocaleString("id-ID")}\n*TOTAL BAYAR: Rp ${m.toLocaleString("id-ID")}*\n*Estimasi Poin:* +${v} Poin\n\nMohon segera diproses ya, terima kasih!`,w=`https://wa.me/628993370200?text=${encodeURIComponent(k)}`,L={id:b,pelanggan:t,produk:h.slice(0,-3),qty:g,total:m,status:"Pending",tanggal:(new Date).toLocaleString("id-ID"),phone:normalizePhone(n),poin:v,point_processed:"No"};ApiService.post("?sheet=orders",{data:[L]}).then(e=>{console.log("Order logged to spreadsheet:",e)}).catch(e=>{console.error("Error logging order:",e)}).finally(()=>{cart=[],saveCart(),updateCartUI(),closeOrderModal(),showSuccessNotification(b,w),e&&setTimeout(()=>{e.disabled=!1,e.innerHTML='\n                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L0 24l6.335-1.662c1.72.937 3.659 1.432 5.631 1.433h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>\n                    Kirim Pesanan ke WhatsApp\n                ',e.classList.remove("opacity-75","cursor-not-allowed")},500)})}function handleLogoClick(){let e=parseInt(sessionStorage.getItem("logo_clicks")||0)+1;sessionStorage.setItem("logo_clicks",e),e>=5&&(sessionStorage.setItem("logo_clicks",0),window.location.href="admin/login.html"),setTimeout(()=>sessionStorage.setItem("logo_clicks",0),3e3)}async function fetchTukarPoin(){const e=document.getElementById("reward-items-list");if(e)try{renderRewardItems(await ApiService.get("?sheet=tukar_poin",{cacheDuration:18e4}))}catch(t){console.error("Error fetching reward items:",t),e.innerHTML='\n            <div class="text-center py-6 bg-red-50 rounded-2xl border-2 border-dashed border-red-200">\n                <p class="text-xs text-red-600 font-semibold">Gagal memuat hadiah. Silakan coba lagi nanti.</p>\n            </div>\n        '}}function renderRewardItems(e){const t=document.getElementById("reward-items-list");t&&(e&&0!==e.length?t.innerHTML=e.map(e=>{const t=e.id||"",n=e.nama||e.judul||"Hadiah",a=e.poin||0;return`\n            <div class="bg-white p-4 rounded-2xl border-2 border-gray-100 hover:border-green-500 transition-all group shadow-sm">\n                <div class="flex gap-4">\n                    <div class="w-20 h-20 bg-gray-100 rounded-xl overflow-hidden flex-shrink-0">\n                        <img src="${e.gambar||"https://via.placeholder.com/100?text=Reward"}" alt="${n}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">\n                    </div>\n                    <div class="flex-1 min-w-0">\n                        <h5 class="font-bold text-gray-800 truncate">${n}</h5>\n                        <p class="text-[10px] text-gray-500 line-clamp-2 mb-2">${e.deskripsi||""}</p>\n                        <div class="flex items-center justify-between">\n                            <div class="bg-amber-100 text-amber-700 px-2 py-1 rounded-lg text-[10px] font-bold flex items-center gap-1">\n                                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>\n                                ${a} Poin\n                            </div>\n                            <button onclick="showConfirmTukarModal('${t}')" class="bg-green-600 hover:bg-green-700 text-white text-[10px] font-bold px-3 py-1.5 rounded-lg transition active:scale-95">\n                                Tukar\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `}).join(""):t.innerHTML='\n            <div class="text-center py-10 bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl border-2 border-dashed border-gray-300">\n                <p class="text-sm text-gray-600 font-semibold">Belum ada hadiah yang tersedia.</p>\n            </div>\n        ')}function openRewardModal(){const e=document.getElementById("reward-modal");e&&(e.classList.remove("hidden"),document.body.classList.add("modal-active"),fetchTukarPoin())}function closeRewardModal(){const e=document.getElementById("reward-modal");e&&(e.classList.add("hidden"),document.body.classList.remove("modal-active"))}function checkUserPoints(){const e=document.getElementById("reward-phone"),t=e?e.value.trim():"";if(!t)return void alert("Mohon masukkan nomor WhatsApp.");const n=normalizePhone(t),a=event.target,o=a?a.innerText:"Cek Poin";a&&"BUTTON"===a.tagName&&(a.innerText="Mencari...",a.disabled=!0),ApiService.get("?sheet=user_points",{cache:!1}).then(e=>{const t=e.find(e=>normalizePhone(e.phone||e.whatsapp||"")===n),a=document.getElementById("points-display"),o=document.querySelector("#points-display h4");if(t){const e=(t.points||t.poin||"0").toString().replace(",","."),a=parseFloat(e)||0;o.innerHTML=`${a.toFixed(1)} <span class="text-sm font-bold">Poin</span>`,sessionStorage.setItem("user_points",a),sessionStorage.setItem("reward_phone",n),sessionStorage.setItem("reward_customer_name",t.nama||t.pelanggan||n),showToast(`Ditemukan ${a.toFixed(1)} poin untuk nomor ini!`)}else o.innerHTML='0.0 <span class="text-sm font-bold">Poin</span>',sessionStorage.setItem("user_points",0),sessionStorage.setItem("reward_phone",n),sessionStorage.setItem("reward_customer_name",n),showToast("Nomor tidak ditemukan atau belum memiliki poin.");a.classList.remove("hidden")}).catch(e=>{console.error("Error checking points:",e),alert("Gagal mengecek poin. Silakan coba lagi.")}).finally(()=>{a&&"BUTTON"===a.tagName&&(a.innerText=o,a.disabled=!1)})}async function claimReward(e){const t=sessionStorage.getItem("reward_phone"),n=parseFloat(sessionStorage.getItem("user_points"))||0;if(t)try{const a=await ApiService.get(`/search?sheet=tukar_poin&id=${e}`,{cache:!1});if(!a||0===a.length)return void alert("Data hadiah tidak ditemukan.");const o=a[0],s=parseFloat(o.poin)||0,i=o.nama||o.judul||"Hadiah";if(n<s)return void alert(`Poin Anda tidak cukup. Dibutuhkan ${s} poin, saldo Anda ${n.toFixed(1)} poin.`);const r=`Tukar ${s} poin Anda dengan "${i}"?\nSaldo poin saat ini: ${n.toFixed(1)}`;if(!confirm(r))return;let l=prompt("Silakan masukkan nama Anda untuk klaim ini:",sessionStorage.getItem("reward_customer_name")||"");if(null===l)return;l=l.trim()||"Pelanggan",showToast("Sedang memproses penukaran...");const d=n-s;await ApiService.patch(`/phone/${t}?sheet=user_points`,{points:d});const c="CLM-"+Date.now().toString().slice(-6);await ApiService.post("?sheet=claims",{data:[{id:c,phone:t,nama:l,hadiah:i,poin:s,status:"Menunggu",tanggal:(new Date).toLocaleString("id-ID")}]}),sessionStorage.setItem("user_points",d);const u=document.querySelector("#points-display h4");u&&(u.innerHTML=`${d.toFixed(1)} <span class="text-sm font-bold">Poin</span>`);const m=`*KLAIM REWARD POIN BERHASIL*\n\nID Klaim: ${c}\nPelanggan: ${l}\nNomor WhatsApp: ${t}\nReward: ${i}\nPoin Ditukar: ${s}\nSisa Poin: ${d.toFixed(1)}\n\nMohon segera diproses. Terima kasih!`,g=`https://wa.me/628993370200?text=${encodeURIComponent(m)}`;showToast("Penukaran poin berhasil!"),setTimeout(()=>{window.open(g,"_blank")},1500)}catch(e){console.error("Error in claimReward:",e),alert("Terjadi kesalahan saat memproses penukaran: "+e.message)}else alert("Mohon cek poin Anda terlebih dahulu.")}document.addEventListener("DOMContentLoaded",()=>{fetchProducts(),fetchTukarPoin();const e=document.getElementById("modal-add-cart");e&&e.addEventListener("click",e=>{const t=document.getElementById("modal-product-name").innerText,n=allProducts.find(e=>e.nama===t);if(n){const t=document.getElementById("modal-qty");addToCart(n,e,t?parseInt(t.value):1),closeDetailModal()}})});let pendingRewardData={id:null,nama:null,poin:null,gambar:null,deskripsi:null};async function showConfirmTukarModal(e){const t=parseFloat(sessionStorage.getItem("user_points"))||0;if(sessionStorage.getItem("reward_phone"))try{const n=await ApiService.get(`/search?sheet=tukar_poin&id=${e}`,{cache:!1});if(!n||0===n.length)return void showToast("Data hadiah tidak ditemukan.");const a=n[0],o=parseFloat(a.poin)||0,s=a.nama||a.judul||"Hadiah";if(t<o)return void showToast(`Poin Anda tidak cukup. Dibutuhkan ${o} poin, saldo Anda ${t.toFixed(1)} poin.`);pendingRewardData={id:e,nama:s,poin:o,gambar:a.gambar||"",deskripsi:a.deskripsi||""},document.getElementById("confirm-reward-name").textContent=s,document.getElementById("confirm-reward-points").textContent=o,document.getElementById("confirm-remaining-points").textContent=(t-o).toFixed(1),document.getElementById("confirm-tukar-modal").classList.remove("hidden"),document.body.classList.add("modal-active")}catch(e){console.error("Error showing confirm modal:",e),showToast("Terjadi kesalahan saat memproses permintaan Anda.")}else showToast("Mohon cek poin Anda terlebih dahulu.")}function cancelTukarModal(){document.getElementById("confirm-tukar-modal").classList.add("hidden"),document.body.classList.remove("modal-active"),pendingRewardData={id:null,nama:null,poin:null,gambar:null,deskripsi:null}}function proceedToNameInput(){document.getElementById("confirm-tukar-modal").classList.add("hidden"),document.getElementById("name-input-modal").classList.remove("hidden"),setTimeout(()=>{document.getElementById("claim-name-input").focus()},100)}function backToConfirmModal(){document.getElementById("name-input-modal").classList.add("hidden"),document.getElementById("confirm-tukar-modal").classList.remove("hidden"),document.getElementById("claim-name-input").value=""}async function submitNameAndClaim(){const e=document.getElementById("claim-name-input").value.trim();e?e.length<3?showToast("Nama harus minimal 3 karakter."):(document.getElementById("name-input-modal").classList.add("hidden"),document.body.classList.remove("modal-active"),await processClaimReward(pendingRewardData.id,e)):showToast("Mohon masukkan nama Anda terlebih dahulu.")}async function processClaimReward(e,t){const n=sessionStorage.getItem("reward_phone"),a=parseFloat(sessionStorage.getItem("user_points"))||0;try{const o=await ApiService.get(`/search?sheet=tukar_poin&id=${e}`,{cache:!1});if(!o||0===o.length)return void showToast("Data hadiah tidak ditemukan.");const s=o[0],i=parseFloat(s.poin)||0,r=s.nama||s.judul||"Hadiah";if(a<i)return void showToast("Poin Anda tidak cukup.");showToast("Sedang memproses penukaran...");const l=a-i;await ApiService.patch(`/phone/${n}?sheet=user_points`,{data:{points:l,last_updated:(new Date).toLocaleString("id-ID")}});const d="CLM-"+Date.now().toString().slice(-6);await ApiService.post("?sheet=claims",{data:[{id:d,phone:n,nama:t,hadiah:r,poin:i,status:"Menunggu",tanggal:(new Date).toLocaleString("id-ID")}]}),sessionStorage.setItem("user_points",l);const c=document.querySelector("#points-display h4");c&&(c.innerHTML=`${l.toFixed(1)} <span class="text-sm font-bold">Poin</span>`);const u=`*KLAIM REWARD POIN BERHASIL*\n\nID Klaim: ${d}\nPelanggan: ${t}\nNomor WhatsApp: ${n}\nReward: ${r}\nPoin Ditukar: ${i}\nSisa Poin: ${l.toFixed(1)}\n\nMohon segera diproses. Terima kasih!`,m=`https://wa.me/628993370200?text=${encodeURIComponent(u)}`;window.claimWhatsAppUrl=m,pendingRewardData={id:null,nama:null,poin:null,gambar:null,deskripsi:null},document.getElementById("name-input-modal").classList.add("hidden"),document.getElementById("confirm-tukar-modal").classList.add("hidden"),setTimeout(()=>{showClaimSuccessModal(d)},300)}catch(e){console.error("Error processing claim:",e),showToast("Gagal memproses penukaran. Silakan coba lagi.")}}const WISHLIST_KEY="gos_wishlist";function getWishlist(){const e=localStorage.getItem(WISHLIST_KEY);return e?JSON.parse(e):[]}function saveWishlist(e){localStorage.setItem(WISHLIST_KEY,JSON.stringify(e)),updateWishlistCount()}function toggleWishlist(e){let t=getWishlist();const n=t.indexOf(e);n>-1?(t.splice(n,1),showToast("Produk dihapus dari Wishlist.")):(t.push(e),showToast("Produk ditambahkan ke Wishlist!")),saveWishlist(t),updateProductWishlistIcon(e);const a=document.getElementById("wishlist-modal");a&&!a.classList.contains("hidden")&&renderWishlistItems()}function isProductInWishlist(e){return getWishlist().includes(e)}function updateWishlistCount(){const e=getWishlist().length,t=document.getElementById("wishlist-count");t&&(t.textContent=e,e>0?t.classList.remove("hidden"):t.classList.add("hidden"))}function updateProductWishlistIcon(e){const t=document.getElementById(`wishlist-btn-${e}`);if(!t)return;const n=isProductInWishlist(e)?'<svg class="w-5 h-5 text-red-500 fill-current" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>':'<svg class="w-5 h-5 text-gray-400 hover:text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>';t.innerHTML=n}function openWishlistModal(){const e=document.getElementById("wishlist-modal");e&&(e.classList.remove("hidden"),document.body.classList.add("modal-active"),renderWishlistItems())}function closeWishlistModal(){const e=document.getElementById("wishlist-modal");e&&(e.classList.add("hidden"),document.body.classList.remove("modal-active"))}async function renderWishlistItems(){const e=getWishlist(),t=document.getElementById("wishlist-items-container");if(!t)return;if(0===e.length)return void(t.innerHTML='\n            <div class="text-center py-10">\n                <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>\n                </svg>\n                <p class="text-gray-500 font-semibold">Wishlist Anda kosong.</p>\n                <p class="text-gray-400 text-sm mt-2">Tambahkan produk favorit Anda!</p>\n            </div>\n        ');allProducts&&0!==allProducts.length||await fetchProducts();const n=allProducts.filter(t=>e.includes(t.id||t.sku));0!==n.length?t.innerHTML=n.map(e=>{const t=e.id||e.sku,n=parseFloat(e.harga_tunai||e.harga||0);return`\n            <div class="flex items-center justify-between p-4 border-b border-gray-100 hover:bg-gray-50 transition">\n                <div class="flex items-center gap-3 flex-1">\n                    <img src="${e.gambar}" alt="${e.nama}" class="w-16 h-16 object-cover rounded-lg shadow-sm">\n                    <div class="flex-1">\n                        <p class="font-semibold text-sm text-gray-800">${e.nama}</p>\n                        <p class="text-xs text-green-600 font-bold mt-1">Rp ${n.toLocaleString("id-ID")}</p>\n                    </div>\n                </div>\n                <div class="flex gap-2">\n                    <button onclick="toggleWishlist('${t}')" class="text-red-500 hover:text-red-700 p-2 transition active:scale-95" title="Hapus dari Wishlist">\n                        <svg class="w-5 h-5 fill-current" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>\n                    </button>\n                    <button onclick="showDetail(${JSON.stringify(e).replace(/"/g,"&quot;")})" class="bg-green-500 hover:bg-green-600 text-white text-xs font-bold px-3 py-1.5 rounded-lg transition active:scale-95">\n                        Beli\n                    </button>\n                </div>\n            </div>\n        `}).join(""):t.innerHTML='<p class="text-center text-gray-500 py-4">Produk tidak ditemukan.</p>'}function showQRISModal(){const e=document.getElementById("qris-modal");e&&e.classList.remove("hidden")}function closeQRISModal(){const e=document.getElementById("qris-modal");e&&e.classList.add("hidden")}async function handleDeepLink(){if(console.log("[DeepLink] Checking for hash:",window.location.hash),0===allProducts.length)return console.log("[DeepLink] Products not loaded yet, waiting..."),void setTimeout(handleDeepLink,500);if(window.location.hash){const e=window.location.hash.substring(1);if(console.log("[DeepLink] Hash found:",e),e.startsWith("produk-")){const t=e.substring(7);console.log("[DeepLink] Looking for product with slug:",t);const n=findProductBySlug(t);n?(console.log("[DeepLink] Product found:",n.nama),setTimeout(()=>{showDetail(n)},500)):console.warn("[DeepLink] Product with slug not found:",t)}}}function showClaimSuccessModal(e){console.log("showClaimSuccessModal called with claimId:",e);const t=document.getElementById("claim-success-modal"),n=document.getElementById("claim-success-id");console.log("Modal element:",t),console.log("Claim ID element:",n),t&&n?(n.textContent=e,t.classList.remove("hidden"),console.log("Modal should now be visible")):console.error("Modal or claimIdElement not found!")}function closeClaimSuccessModal(){const e=document.getElementById("claim-success-modal");e&&e.classList.add("hidden")}function openClaimWhatsApp(){window.claimWhatsAppUrl&&(window.open(window.claimWhatsAppUrl,"_blank"),setTimeout(()=>{closeClaimSuccessModal()},500))}function updatePaymentMethodInfo(e){const t=document.getElementById("payment-method-info"),n=document.getElementById("payment-method-info-text"),a=document.getElementById("qris-display");if(!t||!n)return;const o={tunai:"Pembayaran dilakukan secara tunai saat pesanan diterima atau diambil.",qris:"Pembayaran dilakukan melalui QRIS menggunakan e-wallet atau mobile banking.",gajian:"Pembayaran ditagihkan pada periode gajian berikutnya, jatuh tempo tanggal 6‚Äì7."};t.classList.contains("hidden")||t.classList.add("opacity-0","scale-95"),a&&!a.classList.contains("hidden")&&a.classList.add("opacity-0","scale-95"),setTimeout(()=>{o[e]?(n.textContent=o[e],t.classList.remove("hidden"),t.offsetWidth,setTimeout(()=>{t.classList.remove("opacity-0","scale-95"),t.classList.add("opacity-100","scale-100")},10)):t.classList.add("hidden"),a&&("qris"===e?(a.classList.remove("hidden"),a.offsetWidth,setTimeout(()=>{a.classList.remove("opacity-0","scale-95"),a.classList.add("opacity-100","scale-100")},10)):a.classList.add("hidden"))},150)}document.addEventListener("DOMContentLoaded",updateWishlistCount),window.addEventListener("hashchange",handleDeepLink,!1),document.addEventListener("DOMContentLoaded",()=>{setTimeout(handleDeepLink,1e3)});