let currentBannerEdit=null;async function fetchBanners(){try{const e=CONFIG.getAdminApiUrl();console.log("üîÑ [BANNER-ADMIN] Fetching banners from:",e);const t=await fetch(`${e}?sheet=banners`);if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const n=await t.json();console.log("üì• [BANNER-ADMIN] Received banners:",n),renderBannersTable(n)}catch(e){console.error("‚ùå [BANNER-ADMIN] Error fetching banners:",e);const t=document.getElementById("banners-list");t&&(t.innerHTML=`\n                <tr>\n                    <td colspan="5" class="px-6 py-8 text-center text-gray-500">\n                        <div class="flex flex-col items-center gap-2">\n                            <svg class="w-12 h-12 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>\n                            </svg>\n                            <p class="font-medium">Gagal memuat data banner</p>\n                            <p class="text-sm">${e.message}</p>\n                            <button onclick="fetchBanners()" class="mt-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-bold transition">Coba Lagi</button>\n                        </div>\n                    </td>\n                </tr>\n            `)}}function renderBannersTable(e){const t=document.getElementById("banners-list");t&&(0!==e.length?t.innerHTML=e.map(e=>{const t="active"===e.status?'<span class="bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full font-bold">Aktif</span>':'<span class="bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded-full font-bold">Tidak Aktif</span>';let n="-";if(e.start_date||e.end_date){n=`${e.start_date?new Date(e.start_date).toLocaleDateString("id-ID"):"-"} s/d ${e.end_date?new Date(e.end_date).toLocaleDateString("id-ID"):"-"}`}return`\n            <tr class="hover:bg-gray-50">\n                <td class="px-6 py-4">\n                    <img src="${e.image_url}" alt="${e.title||"Banner"}" class="w-32 h-auto rounded-lg object-cover" onerror="this.src='https://placehold.co/300x100?text=Banner'">\n                </td>\n                <td class="px-6 py-4">\n                    <div class="font-bold text-gray-800">${e.title||"-"}</div>\n                    <div class="text-sm text-gray-500 mt-1">${e.subtitle||"-"}</div>\n                    <div class="text-xs text-gray-400 mt-1">ID: ${e.id}</div>\n                </td>\n                <td class="px-6 py-4">${t}</td>\n                <td class="px-6 py-4">\n                    <div class="text-sm text-gray-700">${n}</div>\n                </td>\n                <td class="px-6 py-4 text-right">\n                    <button onclick='editBanner(${JSON.stringify(e).replace(/'/g,"\\'")})'\n                        class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded-lg text-sm font-bold transition mr-2">\n                        Edit\n                    </button>\n                    <button onclick="deleteBanner('${e.id}')"\n                        class="bg-red-600 hover:bg-red-700 text-white px-3 py-1.5 rounded-lg text-sm font-bold transition">\n                        Hapus\n                    </button>\n                </td>\n            </tr>\n        `}).join(""):t.innerHTML='\n            <tr>\n                <td colspan="5" class="px-6 py-8 text-center text-gray-500">\n                    <div class="flex flex-col items-center gap-2">\n                        <svg class="w-12 h-12 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>\n                        </svg>\n                        <p class="font-medium">Belum ada banner promosi</p>\n                        <p class="text-sm">Klik tombol "Tambah Banner" untuk membuat banner baru</p>\n                    </div>\n                </td>\n            </tr>\n        ')}function openAddBannerModal(){currentBannerEdit=null,document.getElementById("banner-form").reset(),document.getElementById("banner-id").value="",document.getElementById("form-banner-id-input").disabled=!1,document.getElementById("banner-modal-title").textContent="Tambah Banner Promosi",document.getElementById("banner-modal").classList.remove("hidden")}function closeBannerModal(){document.getElementById("banner-modal").classList.add("hidden"),currentBannerEdit=null}function editBanner(e){currentBannerEdit=e,document.getElementById("banner-id").value=e.id,document.getElementById("form-banner-id-input").value=e.id,document.getElementById("form-banner-id-input").disabled=!0,document.getElementById("form-banner-image").value=e.image_url||"",document.getElementById("form-banner-title").value=e.title||"",document.getElementById("form-banner-subtitle").value=e.subtitle||"",document.getElementById("form-banner-cta-text").value=e.cta_text||"",document.getElementById("form-banner-cta-url").value=e.cta_url||"",document.getElementById("form-banner-start-date").value=e.start_date||"",document.getElementById("form-banner-end-date").value=e.end_date||"",document.getElementById("form-banner-status").value=e.status||"active",document.getElementById("banner-modal-title").textContent="Edit Banner Promosi",document.getElementById("banner-modal").classList.remove("hidden")}async function deleteBanner(e){if(confirm("Apakah Anda yakin ingin menghapus banner ini?"))try{const t=CONFIG.getAdminApiUrl();console.log("üóëÔ∏è [BANNER-ADMIN] Deleting banner:",e);const n=await fetch(`${t}/id/${e}?sheet=banners`,{method:"DELETE"});if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);console.log("‚úÖ [BANNER-ADMIN] Banner deleted successfully"),alert("Banner berhasil dihapus!"),await fetchBanners()}catch(e){console.error("‚ùå [BANNER-ADMIN] Error deleting banner:",e),alert("Gagal menghapus banner: "+e.message)}}document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("banner-form");e&&e.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("banner-submit-btn"),n=t.textContent;t.disabled=!0,t.textContent="Menyimpan...";try{const e={id:document.getElementById("form-banner-id-input").value.trim(),image_url:document.getElementById("form-banner-image").value.trim(),title:document.getElementById("form-banner-title").value.trim(),subtitle:document.getElementById("form-banner-subtitle").value.trim(),cta_text:document.getElementById("form-banner-cta-text").value.trim(),cta_url:document.getElementById("form-banner-cta-url").value.trim(),start_date:document.getElementById("form-banner-start-date").value,end_date:document.getElementById("form-banner-end-date").value,status:document.getElementById("form-banner-status").value},t=CONFIG.getAdminApiUrl();if(currentBannerEdit){console.log("üìù [BANNER-ADMIN] Updating banner:",e);const n=await fetch(`${t}/id/${currentBannerEdit.id}?sheet=banners`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:e})});if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);console.log("‚úÖ [BANNER-ADMIN] Banner updated successfully"),alert("Banner berhasil diperbarui!")}else{console.log("‚ûï [BANNER-ADMIN] Creating banner:",e);const n=await fetch(`${t}?sheet=banners`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:[e]})});if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);console.log("‚úÖ [BANNER-ADMIN] Banner created successfully"),alert("Banner berhasil ditambahkan!")}closeBannerModal(),await fetchBanners()}catch(e){console.error("‚ùå [BANNER-ADMIN] Error saving banner:",e),alert("Gagal menyimpan banner: "+e.message)}finally{t.disabled=!1,t.textContent=n}})});