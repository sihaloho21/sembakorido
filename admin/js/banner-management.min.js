var escapeHtml=window.AdminSanitize&&window.AdminSanitize.escapeHtml||(e=>String(e||"")),escapeAttr=window.AdminSanitize&&window.AdminSanitize.escapeAttr||(e=>String(e||"")),sanitizeUrl=window.AdminSanitize&&window.AdminSanitize.sanitizeUrl||(e=>String(e||""));let currentBannerEdit=null,bannerCache=[];async function fetchBanners(){try{const e=CONFIG.getAdminApiUrl();console.log("üîÑ [BANNER-ADMIN] Fetching banners from:",e);const t=await fetch(`${e}?sheet=banners`);if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const n=await t.json();console.log("üì• [BANNER-ADMIN] Received banners:",n),bannerCache=Array.isArray(n)?n:[],renderBannersTable(bannerCache)}catch(e){console.error("‚ùå [BANNER-ADMIN] Error fetching banners:",e),bannerCache=[];const t=document.getElementById("banners-list");t&&(t.innerHTML=`\n                <tr>\n                    <td colspan="5" class="px-6 py-8 text-center text-gray-500">\n                        <div class="flex flex-col items-center gap-2">\n                            <svg class="w-12 h-12 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>\n                            </svg>\n                            <p class="font-medium">Gagal memuat data banner</p>\n                            <p class="text-sm">${escapeHtml(e.message)}</p>\n                            <button data-action="retry-fetch-banners" class="mt-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-bold transition">Coba Lagi</button>\n                        </div>\n                    </td>\n                </tr>\n            `)}}function renderBannersTable(e){const t=document.getElementById("banners-list");t&&(bannerCache=Array.isArray(e)?e:[],0!==bannerCache.length?t.innerHTML=bannerCache.map(e=>{const t="active"===e.status?'<span class="bg-green-100 text-green-700 text-xs px-2 py-1 rounded-full font-bold">Aktif</span>':'<span class="bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded-full font-bold">Tidak Aktif</span>';let n="-";if(e.start_date||e.end_date){n=`${e.start_date?new Date(e.start_date).toLocaleDateString("id-ID"):"-"} s/d ${e.end_date?new Date(e.end_date).toLocaleDateString("id-ID"):"-"}`}const a=escapeHtml(e.title||"-"),r=escapeHtml(e.subtitle||"-"),d=escapeAttr(e.id);return`\n            <tr class="hover:bg-gray-50">\n                <td class="px-6 py-4" data-label="Gambar">\n                    <img src="${sanitizeUrl(e.image_url,"https://placehold.co/300x100?text=Banner")}" alt="${a||"Banner"}" class="w-32 h-auto rounded-lg object-cover" data-fallback-src="https://placehold.co/300x100?text=Banner">\n                </td>\n                <td class="px-6 py-4" data-label="Banner">\n                    <div class="font-bold text-gray-800">${a}</div>\n                    <div class="text-sm text-gray-500 mt-1">${r}</div>\n                    <div class="text-xs text-gray-400 mt-1">ID: ${d}</div>\n                </td>\n                <td class="px-6 py-4" data-label="Status">${t}</td>\n                <td class="px-6 py-4" data-label="Periode">\n                    <div class="text-sm text-gray-700">${n}</div>\n                </td>\n                <td class="px-6 py-4 text-right" data-label="Aksi">\n                    <button data-action="edit-banner" data-id="${d}"\n                        class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1.5 rounded-lg text-sm font-bold transition mr-2">\n                        Edit\n                    </button>\n                    <button data-action="delete-banner" data-id="${d}"\n                        class="bg-red-600 hover:bg-red-700 text-white px-3 py-1.5 rounded-lg text-sm font-bold transition">\n                        Hapus\n                    </button>\n                </td>\n            </tr>\n        `}).join(""):t.innerHTML='\n            <tr>\n                <td colspan="5" class="px-6 py-8 text-center text-gray-500">\n                    <div class="flex flex-col items-center gap-2">\n                        <svg class="w-12 h-12 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>\n                        </svg>\n                        <p class="font-medium">Belum ada banner promosi</p>\n                        <p class="text-sm">Klik tombol "Tambah Banner" untuk membuat banner baru</p>\n                    </div>\n                </td>\n            </tr>\n        ')}function openAddBannerModal(){currentBannerEdit=null,document.getElementById("banner-form").reset(),document.getElementById("banner-id").value="",document.getElementById("form-banner-id-input").disabled=!1,document.getElementById("banner-modal-title").textContent="Tambah Banner Promosi",document.getElementById("banner-modal").classList.remove("hidden")}function closeBannerModal(){document.getElementById("banner-modal").classList.add("hidden"),currentBannerEdit=null}function editBanner(e){currentBannerEdit=e,document.getElementById("banner-id").value=e.id,document.getElementById("form-banner-id-input").value=e.id,document.getElementById("form-banner-id-input").disabled=!0,document.getElementById("form-banner-image").value=e.image_url||"",document.getElementById("form-banner-title").value=e.title||"",document.getElementById("form-banner-subtitle").value=e.subtitle||"",document.getElementById("form-banner-cta-text").value=e.cta_text||"",document.getElementById("form-banner-cta-url").value=e.cta_url||"",document.getElementById("form-banner-start-date").value=e.start_date||"",document.getElementById("form-banner-end-date").value=e.end_date||"",document.getElementById("form-banner-status").value=e.status||"active",document.getElementById("banner-modal-title").textContent="Edit Banner Promosi",document.getElementById("banner-modal").classList.remove("hidden")}function editBannerById(e){const t=bannerCache.find(t=>String(t.id)===String(e));t?editBanner(t):alert("Banner tidak ditemukan.")}function bindBannerActions(){document.addEventListener("click",e=>{const t=e.target.closest("[data-action]");if(!t)return;const n=t.dataset.action;"retry-fetch-banners"!==n?"edit-banner"!==n?"delete-banner"===n&&deleteBanner(t.dataset.id):editBannerById(t.dataset.id):fetchBanners()}),document.addEventListener("error",e=>{const t=e.target;if(t&&t.matches&&t.matches("img[data-fallback-src]")){const e=t.getAttribute("data-fallback-src");e&&t.src!==e&&(t.src=e)}},!0)}async function deleteBanner(e){if(confirm("Apakah Anda yakin ingin menghapus banner ini?"))try{console.log("üóëÔ∏è [BANNER-ADMIN] Deleting banner:",e),await GASActions.delete("banners",e),console.log("‚úÖ [BANNER-ADMIN] Banner deleted successfully"),alert("Banner berhasil dihapus!"),await fetchBanners()}catch(e){console.error("‚ùå [BANNER-ADMIN] Error deleting banner:",e),alert("Gagal menghapus banner: "+e.message)}}document.addEventListener("DOMContentLoaded",()=>{bindBannerActions();const e=document.getElementById("banner-form");e&&e.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("banner-submit-btn"),n=t.textContent;t.disabled=!0,t.textContent="Menyimpan...";try{const e=document.getElementById("form-banner-id-input").value.trim(),t={id:e,image_url:document.getElementById("form-banner-image").value.trim(),title:document.getElementById("form-banner-title").value.trim(),subtitle:document.getElementById("form-banner-subtitle").value.trim(),cta_text:document.getElementById("form-banner-cta-text").value.trim(),cta_url:document.getElementById("form-banner-cta-url").value.trim(),start_date:document.getElementById("form-banner-start-date").value,end_date:document.getElementById("form-banner-end-date").value,status:document.getElementById("form-banner-status").value};currentBannerEdit?(console.log("üìù [BANNER-ADMIN] Updating banner:",t),await GASActions.update("banners",currentBannerEdit.id,t),console.log("‚úÖ [BANNER-ADMIN] Banner updated successfully"),alert("Banner berhasil diperbarui!")):(e||(t.id=Date.now().toString()),console.log("‚ûï [BANNER-ADMIN] Creating banner:",t),await GASActions.create("banners",t),console.log("‚úÖ [BANNER-ADMIN] Banner created successfully"),alert("Banner berhasil ditambahkan!")),closeBannerModal(),await fetchBanners()}catch(e){console.error("‚ùå [BANNER-ADMIN] Error saving banner:",e),alert("Gagal menyimpan banner: "+e.message)}finally{t.disabled=!1,t.textContent=n}})});